<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão Firebase</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa; 
            color: #343a40; 
            line-height: 1.7;
            font-size: 17px; 
        }
        .container {
            width: 85%; 
            margin: 30px auto; 
            padding: 30px; 
            background: #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.12); 
            border-radius: 12px; 
        }
        h1 {
            color: #0056b3; 
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.8em; 
            font-weight: 700;
        }
        h2 { 
            color: #17a2b8; 
            margin-top: 25px;
            margin-bottom: 20px;
            font-size: 2em; 
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            font-weight: 500;
        }
        .tab-navigation {
            overflow: hidden;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 30px; 
        }
        .tab-navigation button {
            background-color: #e9ecef; 
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 16px 22px; 
            transition: background-color 0.3s ease, color 0.3s ease;
            font-size: 1.1em; 
            border-radius: 8px 8px 0 0; 
            margin-right: 8px;
            color: #495057; 
            font-weight: 500;
        }
        .tab-navigation button:hover {
            background-color: #ced4da; 
            color: #0056b3;
        }
        .tab-navigation button.active {
            background-color: #007bff; 
            color: white;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1) inset;
        }
        .tab-content {
            display: none;
            padding: 20px; 
            border-top: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(10px);}
            to {opacity: 1; transform: translateY(0);}
        }
        form { 
            display: flex;
            flex-direction: column;
            gap: 25px; 
        }
        form div, form fieldset { 
            display: flex;
            flex-direction: column;
            position: relative;
            gap: 8px; 
        }
        
        label { 
            margin-bottom: 0px; 
            font-weight: 500;
            font-size: 1.1em; 
            color: #495057;
        }
        input[type="text"], input[type="url"], input[type="number"], select { 
            padding: 12px; 
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1em; 
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        input[type="text"]:focus, input[type="url"]:focus, input[type="number"]:focus, select:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
            outline: none;
        }
        input[readonly] { 
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        button[type="submit"], .action-button { 
            background-color: #28a745;
            color: white;
            padding: 12px 20px; 
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.05em; 
            align-self: flex-start;
            transition: background-color 0.2s ease, transform 0.1s ease;
            font-weight: 500;
        }
        button[type="submit"]:hover, .action-button:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }
        button[type="submit"]:active, .action-button:active {
            transform: translateY(0px);
        }
        .action-button.secondary { background-color: #6c757d; }
        .action-button.secondary:hover { background-color: #5a6268; }
        .action-button.danger { background-color: #dc3545; }
        .action-button.danger:hover { background-color: #c82333; }

        .status-message {
            margin-top: 20px; padding: 15px; border-radius: 6px; font-size: 1em; font-weight: 500;
        }
        .status-message.success { background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
        .status-message.error { background-color: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }
        
        .suggestions-container {
            position: absolute; border: 1px solid #ced4da; border-top: none; z-index: 99;
            top: 100%; left: 0; right: 0; background-color: white; max-height: 180px;
            overflow-y: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 0 0 6px 6px;
        }
        .suggestion-item { 
            padding: 8px 12px; 
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 1em;
            display: flex; 
            flex-direction: row;
            align-items: center; 
        }
        .suggestion-item img {
            width: 30px; 
            height: 30px;
            object-fit: contain; 
            margin-right: 10px;
            border-radius: 50%; 
            border: 1px solid #ddd; 
            flex-shrink: 0;
        }
        .suggestion-item span {
            flex-grow: 1;
            line-height: 1.4;
        }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover { background-color: #f0f8ff; color: #0056b3; }

        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe; margin: 10% auto; padding: 25px; border: 1px solid #888;
            width: 60%; max-width: 550px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .modal-content h3 { margin-top: 0; color: #007bff; }
        .modal-close-btn {
            color: #aaa; float: right; font-size: 28px; font-weight: bold;
        }
        .modal-close-btn:hover, .modal-close-btn:focus { color: black; text-decoration: none; cursor: pointer; }
        
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
         @media (min-width: 600px) {
            .form-grid.two-cols { grid-template-columns: 1fr 1fr; }
            .form-grid.three-cols { grid-template-columns: repeat(3, 1fr); align-items: end; }
        }
        
        /* ============================================ */
        /* === STYLES SPECIFIC TO #tabJogo === */
        /* ============================================ */

        #tabJogo h2 {
            color: #007bff; 
            border-bottom: 2px solid #007bff;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.2em; 
        }

        #tabJogo form {
            gap: 30px; 
        }

        #tabJogo fieldset {
            border: 1px solid #ced4da; 
            border-radius: 10px; 
            padding: 25px; 
            background-color: #ffffff; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.07); 
            transition: all 0.3s ease-in-out;
        }

        #tabJogo fieldset:nth-of-type(1) { /* Informações Gerais */
            border-left: 5px solid #17a2b8; 
            background-color: #f8f9fa; 
        }
        #tabJogo fieldset:nth-of-type(1) legend { color: #17a2b8; }

        #tabJogo fieldset:nth-of-type(2) { /* Golos do Sporting */
            border-left: 5px solid #28a745; 
        }
        #tabJogo fieldset:nth-of-type(2) legend { color: #28a745; }
        
        #tabJogo fieldset#fieldsetPlacarStats { /* Placar e Estatísticas */
            border-left: 5px solid #ffc107; 
            background-color: #fdf8e2; 
        }
        #tabJogo fieldset#fieldsetPlacarStats.open {
            background-color: #f8f9fa; 
        }
        #tabJogo fieldset#fieldsetPlacarStats legend#legendPlacarStats { 
            color: #c89400; 
        }
        
        #tabJogo fieldset#fieldsetPlantel { /* Plantel */
            border-left: 5px solid #6f42c1; 
        }
        #tabJogo fieldset#fieldsetPlantel legend { color: #6f42c1; }

        #tabJogo fieldset#fieldsetEstadoJogo { /* Estado do Jogo */
            border-left: 5px solid #fd7e14; 
        }
        #tabJogo fieldset#fieldsetEstadoJogo legend { color: #fd7e14; }

        .estado-jogo-checkbox-container {
            display: flex;
            flex-direction: row; 
            align-items: center; 
            gap: 25px; 
            flex-wrap: wrap; 
            padding: 5px 0; 
        }

        .checkbox-item-wrapper {
            display: flex;
            align-items: center; 
        }

        .checkbox-item-wrapper input[type="checkbox"] {
            margin-right: 5px; 
            width: auto; 
            height: auto;
            vertical-align: middle;
        }
        
        .checkbox-item-wrapper label {
            margin-bottom: 0; 
            font-size: 1.1em; 
            color: #343a40;
            font-weight: 500; 
        }


        #tabJogo legend {
            font-size: 1.6em; 
            font-weight: 600; 
            padding: 0 15px;
            margin-bottom: 15px; 
        }

        #tabJogo label { 
            font-size: 1.2em; 
            color: #343a40; 
            margin-bottom: 8px; 
        }

        #tabJogo input[type="text"],
        #tabJogo input[type="url"],
        #tabJogo input[type="number"],
        #tabJogo select {
            font-size: 1.1em; 
            padding: 14px; 
            border-radius: 6px;
            border: 1px solid #bcc3ca; 
        }
        
        #tabJogo input#jogoClubeCasa.has-image-bg,
        #tabJogo input#jogoClubeFora.has-image-bg {
            background-repeat: no-repeat;
            background-position: 8px center;  
            background-size: 28px 28px;    
            padding-left: 42px !important; 
        }
        
        #tabJogo .player-input-grid input[type="text"].has-image-bg,
        #goalDetailModal input[type="text"].has-image-bg {
            background-repeat: no-repeat;
            background-position: 8px center;  
            background-size: 28px 28px;    
            padding-left: 42px !important;  
        }


        #tabJogo input[readonly] {
            background-color: #e2e6ea; 
            color: #495057;
            font-weight: 500;
        }

        #tabJogo .minute-input-group {
            display: flex; align-items: center; gap: 12px; margin-bottom: 15px;
        }
        #tabJogo .minute-input-group input[type="number"] { flex-grow: 1; }
        #tabJogo .minute-list { list-style: none; padding: 0; }
        
        #tabJogo .minute-list-item {
            padding: 10px 15px; font-size: 1em; 
            border-radius: 4px; margin-bottom: 5px;
            display: flex; /* This makes minute-text-scorer-container and remove-minute-btn align in a row */
            justify-content: space-between; 
            align-items: center; 
            transition: background-color 0.3s ease, border-left-color 0.3s ease; 
            border-left: 5px solid transparent; 
        }
        
        /* CRITICAL FOR INLINE GOAL DISPLAY */
        #tabJogo .minute-text-scorer-container {
    display: flex;
    flex-direction: row;   /* Garante que os itens fiquem em linha */
    justify-content: flex-start; /* Alinha o grupo de itens à esquerda dentro deste container */
    align-items: center;   /* Alinha os itens verticalmente ao centro da linha */
    flex-grow: 1;
    margin-right: 8px;
    flex-wrap: nowrap;     /* Impede que os itens quebrem para uma nova linha */
}
        
        #tabJogo .minute-text-scorer-container > * {
             /* Ensures children behave as expected flex items and don't force new lines */
            /* display: inline-block; /* Generally not needed for span/img in flex, but can be a fallback */
            /* vertical-align: middle; /* Good for alignment if flex align-items fails */
        }
        
        #tabJogo .minute-text-scorer-container .minute-value,
        #tabJogo .minute-text-scorer-container .scorer-name {
            white-space: nowrap; /* Prevents text itself from wrapping */
        }

        #tabJogo .minute-list-item .minute-value { 
            font-weight: 500; 
            cursor: pointer; 
            text-decoration: underline;
        }

        #tabJogo .minute-list-separator {
            margin: 0 8px; 
            color: #555;
        }

        #tabJogo .minute-list-player-image {
            width: 24px; 
            height: 24px;
            object-fit: cover; 
            border-radius: 50%; 
            margin-right: 6px; 
            border: 1px solid #ddd; 
            flex-shrink: 0; 
        }
        
        #tabJogo .minute-list-item .scorer-name { 
            font-style: normal; 
            color: #333; 
            margin-left: 0; 
            font-size: 1em; 
            font-weight: 500;
        }
        /* END CRITICAL SECTION */

        #tabJogo .minute-list-item .remove-minute-btn {
            background: none; border: none; color: #dc3545; cursor: pointer;
            font-weight: bold; font-size: 1.3em; 
            flex-shrink: 0; 
        }
        #tabJogo .minute-list-item.status-pending { background-color: #fde0e0; border-left-color: #dc3545; }
        #tabJogo .minute-list-item.status-pending .minute-value { color: #721c24; }
        #tabJogo .minute-list-item.status-incomplete { background-color: #fff9e0; border-left-color: #ffc107; }
        #tabJogo .minute-list-item.status-incomplete .minute-value { color: #856404; }
        #tabJogo .minute-list-item.status-complete { background-color: #d4edda; border-left-color: #28a745; }
        #tabJogo .minute-list-item.status-complete .minute-value { color: #155724; }


        #tabJogo > form > button[type="submit"] {
            padding: 15px 30px; font-size: 1.25em; background-color: #0069d9; 
            font-weight: 600; width: auto; align-self: center; margin-top: 20px; 
        }
        #tabJogo > form > button[type="submit"]:hover { background-color: #0056b3; }

        #tabJogo .suggestions-container { border-color: #adb5bd; font-size: 1em; }
        #tabJogo .suggestion-item { padding: 12px; }

        #tabJogo .player-input-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 18px; margin-bottom: 20px; 
        }
        #tabJogo .player-input-wrapper {
            position: relative; 
            display: flex;      
            align-items: center;
        }
        #tabJogo .player-input-grid input[type="text"] { 
            background-color: #fff; 
            width: 100%;
            box-sizing: border-box;
        }
        .player-input-clear-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #888;
            font-size: 1.4em; 
            font-weight: bold;
            cursor: pointer;
            padding: 0 5px; 
            line-height: 1;
            display: none; 
            z-index: 2; 
        }
        .player-input-clear-btn:hover { color: #333; }
        #tabJogo .player-input-grid input[type="text"].has-image-bg.has-clear-btn,
        #goalDetailModal input[type="text"].has-image-bg.has-clear-btn { 
            padding-right: 35px !important; 
        }
        #tabJogo .player-input-grid input[type="text"].has-clear-btn:not(.has-image-bg),
        #goalDetailModal input[type="text"].has-clear-btn:not(.has-image-bg) {
            padding-right: 35px !important; 
        }


        #goalDetailModal .modal-content { padding: 30px; }
        #goalDetailModal .modal-content label { font-size: 1.15em; }
        #goalDetailModal .modal-content input[type="text"],
        #goalDetailModal .modal-content select,
        #goalDetailModal #goalZoneGridContainer { font-size: 1.05em; }
        
        #goalZoneGridContainer {
            display: grid; grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 55px); gap: 6px;
            margin-top: 5px; border: 1px solid #ccc; padding: 5px; border-radius: 4px;
        }
        .goal-zone-cell {
            display: flex; align-items: center; justify-content: center;
            border: 1px solid #ddd; background-color: #f9f9f9; cursor: pointer;
            font-size: 0.9em; text-align: center; transition: background-color 0.2s;
        }
        .goal-zone-cell:hover { background-color: #e9e9e9; }
        .goal-zone-cell.selected { background-color: #007bff; color: white; border-color: #0056b3; }

        #tabJogo .toggle-legend {
            cursor: pointer; display: flex; justify-content: space-between; 
            align-items: center; width: 100%; 
            padding-left: 15px; padding-right: 15px; box-sizing: border-box; 
        }
        #tabJogo .toggle-legend .toggle-indicator { font-weight: bold; font-size: 1.2em; margin-left: 10px; }
        
        #tabJogo fieldset.open .toggle-content { animation: slideDown 0.3s ease-out; }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); max-height: 0; }
            to { opacity: 1; transform: translateY(0); max-height: 1000px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Painel de Gestão Firebase</h1>

        <div class="tab-navigation">
            <button class="tab-button" onclick="openTab(event, 'tabJogo')">Criar Jogo</button>
            <button class="tab-button" onclick="openTab(event, 'tabClube')">Criar Clube</button>
            <button class="tab-button" onclick="openTab(event, 'tabPosicao')">Criar Posição</button>
            <button class="tab-button" onclick="openTab(event, 'tabJogador')">Criar Jogador</button>
            <button class="tab-button" onclick="openTab(event, 'tabPais')">Criar País</button>
        </div>

        <!-- Tab Criar Jogo -->
        <div id="tabJogo" class="tab-content">
            <h2>Criar Novo Jogo</h2>
            <form id="formJogo">
                <fieldset> 
                    <legend>Informações Gerais do Jogo</legend>
                    <div class="form-grid two-cols">
                        <div>
                            <label for="jogoTemporada">Temporada:</label>
                            <select id="jogoTemporada" required></select>
                        </div>
                        <div>
                            <label for="jogoJornada">Jornada:</label>
                            <select id="jogoJornada" required></select>
                        </div>
                        <div>
                            <label for="jogoClubeCasa">Clube Casa:</label>
                            <input type="text" id="jogoClubeCasa" autocomplete="off" placeholder="Pesquisar clube..." required>
                            <div id="clubeCasaSuggestions" class="suggestions-container" style="display: none;"></div>
                        </div>
                        <div>
                            <label for="jogoClubeFora">Clube Fora:</label>
                            <input type="text" id="jogoClubeFora" autocomplete="off" placeholder="Pesquisar clube..." required>
                            <div id="clubeForaSuggestions" class="suggestions-container" style="display: none;"></div>
                        </div>
                    </div>
                </fieldset>

                <fieldset> 
                    <legend>Golos do Sporting</legend>
                    <div class="form-grid two-cols">
                        <div>
                            <label for="jogoMinutoGoloMarcado">Minuto do Golo Marcado (Sporting):</label>
                            <div class="minute-input-group">
                                <input type="number" id="jogoMinutoGoloMarcadoInput" placeholder="Ex: 17" min="1">
                                <button type="button" class="action-button secondary" id="addMinutoGoloMarcadoBtn">Adicionar</button>
                            </div>
                            <ul id="listaMinutosGolosMarcados" class="minute-list"></ul>
                        </div>
                        <div>
                            <label for="jogoMinutoGoloSofrido">Minuto do Golo Sofrido (pelo Sporting):</label>
                            <div class="minute-input-group">
                                <input type="number" id="jogoMinutoGoloSofridoInput" placeholder="Ex: 48" min="1">
                                <button type="button" class="action-button secondary" id="addMinutoGoloSofridoBtn">Adicionar</button>
                            </div>
                            <ul id="listaMinutosGolosSofridos" class="minute-list"></ul>
                        </div>
                    </div>
                </fieldset>

                <fieldset id="fieldsetPlacarStats"> 
                    <legend id="legendPlacarStats" class="toggle-legend">
                        Placar e Estatísticas (Automático)
                        <span class="toggle-indicator">[+]</span>
                    </legend>
                    <div class="toggle-content" style="display: none;">
                        <div style="margin-bottom: 15px;">
                            <label for="jogoNomeJogo">Nome do Jogo (Automático):</label>
                            <input type="text" id="jogoNomeJogo" readonly>
                        </div>
                        <div class="form-grid three-cols">
                            <div><label for="jogoGMCasa">Golos Marcados Equipa da Casa:</label><input type="text" id="jogoGMCasa" readonly></div>
                            <div><label for="jogoResultadoFinal">Resultado Final:</label><input type="text" id="jogoResultadoFinal" readonly></div>
                            <div><label for="jogoGMFora">Golos Marcados Equipa de Fora:</label><input type="text" id="jogoGMFora" readonly></div>
                        </div>
                         <div class="form-grid two-cols" style="margin-top: 15px;">
                            <div><label for="jogoGSCasa">Golos Sofridos Equipa da Casa:</label><input type="text" id="jogoGSCasa" readonly></div>
                            <div><label for="jogoGSFora">Golos Sofridos Equipa de Fora:</label><input type="text" id="jogoGSFora" readonly></div>
                            
                            <div><label for="jogoMarcados1P">Golos Marcados Sporting (1ª Parte):</label><input type="text" id="jogoMarcados1P" readonly></div>
                            <div><label for="jogoMarcados2P">Golos Marcados Sporting (2ª Parte):</label><input type="text" id="jogoMarcados2P" readonly></div>
                            <div><label for="jogoSofridos1P">Golos Sofridos Sporting (1ª Parte):</label><input type="text" id="jogoSofridos1P" readonly></div>
                            <div><label for="jogoSofridos2P">Golos Sofridos Sporting (2ª Parte):</label><input type="text" id="jogoSofridos2P" readonly></div>
                            <div><label for="jogoEstado">Estado (Resultado Sporting):</label><input type="text" id="jogoEstado" readonly></div>
                        </div>
                    </div>
                </fieldset>

                <fieldset id="fieldsetPlantel"> 
                    <legend>Plantel</legend>
                    <div>
                        <label>11 Inicial (11 jogadores):</label>
                        <div id="jogo11InicialContainer" class="player-input-grid"></div>
                    </div>
                    <div>
                        <label>Suplentes (11 jogadores):</label>
                        <div id="jogoSuplentesContainer" class="player-input-grid"></div>
                    </div>
                </fieldset>

                <fieldset id="fieldsetEstadoJogo">
                    <legend>Estado do Jogo</legend>
                    <div class="estado-jogo-checkbox-container">
                        <div class="checkbox-item-wrapper">
                            <input type="checkbox" id="jogoLive">
                            <label for="jogoLive">Live</label>
                        </div>
                        <div class="checkbox-item-wrapper">
                            <input type="checkbox" id="jogoTerminado">
                            <label for="jogoTerminado">Terminado</label>
                        </div>
                        <div class="checkbox-item-wrapper">
                            <input type="checkbox" id="jogoFuturo">
                            <label for="jogoFuturo">Futuro</label>
                        </div>
                    </div>
                </fieldset>

                <button type="submit">Criar Jogo</button>
            </form>
            <div id="statusJogo" class="status-message"></div>
        </div>

        <!-- Tab Criar Clube -->
        <div id="tabClube" class="tab-content">
            <h2>Criar Novo Clube</h2>
            <form id="formClube">
                <div><label for="clubeNome">Nome do Clube:</label><input type="text" id="clubeNome" required></div>
                <div><label for="clubeLogo">Link do Logo:</label><input type="url" id="clubeLogo" required></div>
                <div><label for="clubeRegiao">Região:</label><input type="text" id="clubeRegiao" required></div>
                <div><label for="clubeCidade">Cidade:</label><input type="text" id="clubeCidade" required></div>
                <button type="submit">Adicionar Clube</button>
            </form>
            <div id="statusClube" class="status-message"></div>
        </div>

        <!-- Tab Criar Posição -->
        <div id="tabPosicao" class="tab-content">
            <h2>Criar Nova Posição</h2>
            <form id="formPosicao">
                <div><label for="posicaoAbreviacao">Abreviação (ex: DC, PL):</label><input type="text" id="posicaoAbreviacao" required maxlength="3"></div>
                <div><label for="posicaoGenericaForm">Posição Genérica (ex: Defesa, Avançado):</label><input type="text" id="posicaoGenericaForm" required></div>
                <button type="submit">Adicionar Posição</button>
            </form>
            <div id="statusPosicao" class="status-message"></div>
        </div>

        <!-- Tab Criar Jogador -->
        <div id="tabJogador" class="tab-content">
            <h2>Criar Novo Jogador</h2>
            <form id="formJogador">
                <div><label for="jogadorNome">Nome do Jogador:</label><input type="text" id="jogadorNome" required></div>
                <div><label for="jogadorImagem">Link da Imagem:</label><input type="url" id="jogadorImagem" required></div>
                <div>
                    <label for="jogadorPosEspecifica">Posição Específica:</label>
                    <select id="jogadorPosEspecifica" required><option value="">A carregar posições...</option></select>
                </div>
                <div><label for="jogadorPosGenerica">Posição Genérica (Automático):</label><input type="text" id="jogadorPosGenerica" readonly></div>
                <div>
                    <label for="jogadorPaisNome">Nome do País:</label>
                    <input type="text" id="jogadorPaisNome" autocomplete="off" placeholder="Comece a digitar..." required>
                    <div id="paisSuggestions" class="suggestions-container" style="display: none;"></div>
                </div>
                <button type="submit">Adicionar Jogador</button>
            </form>
            <div id="statusJogador" class="status-message"></div>
        </div>

        <!-- Tab Criar País -->
        <div id="tabPais" class="tab-content">
            <h2>Criar Novo País</h2>
            <form id="formPais">
                <div><label for="paisNome">Nome do País:</label><input type="text" id="paisNome" required></div>
                <div><label for="paisBandeira">Link da Bandeira:</label><input type="url" id="paisBandeira" required></div>
                <div>
                    <label for="paisContinenteSelect">Continente:</label>
                    <select id="paisContinenteSelect" required>
                        <option value="">A carregar continentes...</option>
                    </select>
                </div>
                <button type="submit">Adicionar País</button>
            </form>
            <div id="statusPais" class="status-message"></div>
        </div>
    </div> <!-- End of .container -->

    <!-- Modal for Goal Details -->
    <div id="goalDetailModal" class="modal">
        <div class="modal-content">
            <span class="modal-close-btn" id="closeGoalDetailModalBtn">×</span>
            <h3 id="goalDetailModalTitle">Detalhes do Golo</h3>
            <form id="formGoalDetail">
                <input type="hidden" id="goalDetailType">
                <input type="hidden" id="goalDetailMinute">
                
                <div id="goalDetailScorerSection">
                    <label for="goalDetailJogador">Marcador (Jogador do Sporting):</label>
                    <input type="text" id="goalDetailJogador" autocomplete="off" placeholder="Pesquisar jogador...">
                    <div id="goalDetailJogadorSuggestions" class="suggestions-container" style="display: none;"></div>
                </div>
                
                <div>
                    <label for="goalDetailZonaGrid">Zona do Golo:</label>
                    <div id="goalZoneGridContainer"></div>
                    <input type="hidden" id="selectedGoalZoneHidden">
                </div>

                <div id="goalDetailAssistenciaSection" style="margin-top:15px;">
                    <label for="goalDetailAssistencia">Assistência (Jogador do Sporting):</label>
                    <input type="text" id="goalDetailAssistencia" autocomplete="off" placeholder="Pesquisar jogador...">
                    <div id="goalDetailAssistenciaSuggestions" class="suggestions-container" style="display: none;"></div>
                </div>
                <button type="button" id="saveGoalDetailBtn" class="action-button" style="margin-top:20px;">Guardar Detalhes</button>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, setDoc, collection, getDocs, serverTimestamp, addDoc, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyASIFSwhZj8B4ON6fVGjNixgLW-CL39CnI", 
            authDomain: "sporting-stats.firebaseapp.com",
            projectId: "sporting-stats",
            storageBucket: "sporting-stats.firebasestorage.app",
            messagingSenderId: "584175657940",
            appId: "1:584175657940:web:7e57b0b83f2b22646d6c41"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let posicoesMap = new Map();
        let allPaises = [];
        let allContinentesSet = new Set();
        
        let allClubes = [];
        let allJogadores = []; 
        let minutosGolosMarcados = []; 
        let minutosGolosSofridos = []; 
        const goalZoneNames = [
            "Esquerda Cima", "Meio Cima", "Direita Cima",
            "Esquerda Centro", "Meio Centro", "Direita Centro",
            "Esquerda Baixo", "Meio Baixo", "Direita Baixo"
        ];
        
        let sportingClubeDetalhes = null;
        const SPORTING_CP_CANONICAL_NAME = "Sporting CP"; 
        const sportingCanonicoNomesInputCheck = ["sporting cp", "sporting"]; 

        const jogoLiveCheckbox = document.getElementById('jogoLive');
        const jogoTerminadoCheckbox = document.getElementById('jogoTerminado');
        const jogoFuturoCheckbox = document.getElementById('jogoFuturo');

        function syncGameStatusCheckboxes() {
            const source = this; 

            if (source === jogoTerminadoCheckbox && jogoTerminadoCheckbox.checked) {
                jogoLiveCheckbox.checked = false;
                jogoFuturoCheckbox.checked = false;
            } else if (source === jogoLiveCheckbox && jogoLiveCheckbox.checked) {
                jogoTerminadoCheckbox.checked = false;
                jogoFuturoCheckbox.checked = false;
            } else if (source === jogoFuturoCheckbox && jogoFuturoCheckbox.checked) {
                jogoLiveCheckbox.checked = false;
                jogoTerminadoCheckbox.checked = false;
            }
            
            if (jogoTerminadoCheckbox.checked) { 
                jogoLiveCheckbox.checked = false;
                jogoFuturoCheckbox.checked = false;
            } else if (jogoLiveCheckbox.checked) { 
                jogoFuturoCheckbox.checked = false;
            } else { 
                jogoFuturoCheckbox.checked = true;
            }
        }

        jogoLiveCheckbox.addEventListener('change', syncGameStatusCheckboxes);
        jogoTerminadoCheckbox.addEventListener('change', syncGameStatusCheckboxes);
        jogoFuturoCheckbox.addEventListener('change', syncGameStatusCheckboxes);


        window.openTab = function(evt, tabName) {
            var i, tabcontent, tabbuttons;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tabbuttons = document.getElementsByClassName("tab-button");
            for (i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].className = tabbuttons[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            if (evt && evt.currentTarget) { 
                 evt.currentTarget.className += " active";
            }

            if (tabName === 'tabJogador') {
                loadPosicoesParaDropdown();
                loadPaisesParaSugestoes();
            } else if (tabName === 'tabPais') {
                loadContinentesParaDropdown();
            } else if (tabName === 'tabJogo') {
                populateTemporadaDropdown();
                setSuggestedJornada(); 
                loadClubesParaJogo(); 
                loadJogadoresParaJogo().then(() => { 
                    if (document.getElementById('jogo11InicialContainer').children.length === 0) {
                         setupDynamicPlayerInputs('jogo11InicialContainer', 11, 'inicial');
                    }
                    if (document.getElementById('jogoSuplentesContainer').children.length === 0) {
                        setupDynamicPlayerInputs('jogoSuplentesContainer', 11, 'suplente');
                    }
                });
                if (goalZoneGridContainer.children.length === 0) { 
                    populateGoalZoneGrid();
                }
                syncGameStatusCheckboxes.call(window); 
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const defaultTabButton = document.querySelector('.tab-button[onclick*="tabJogo"]');
            if (defaultTabButton) {
                 openTab({ currentTarget: defaultTabButton }, 'tabJogo');
            }
            
            const placarStatsLegend = document.getElementById('legendPlacarStats');
            const placarStatsContent = document.querySelector('#fieldsetPlacarStats .toggle-content');
            const placarStatsFieldset = document.getElementById('fieldsetPlacarStats');
            const placarStatsIndicator = placarStatsLegend.querySelector('.toggle-indicator');

            if (placarStatsLegend && placarStatsContent && placarStatsIndicator && placarStatsFieldset) {
                placarStatsLegend.addEventListener('click', () => {
                    const isOpen = placarStatsContent.style.display === 'block';
                    if (isOpen) {
                        placarStatsContent.style.display = 'none';
                        placarStatsIndicator.textContent = '[+]';
                        placarStatsFieldset.classList.remove('open');
                    } else {
                        placarStatsContent.style.display = 'block';
                        placarStatsIndicator.textContent = '[-]';
                        placarStatsFieldset.classList.add('open');
                    }
                });
            } else {
                console.warn("Toggle elements for Placar/Estatísticas not found.");
            }

            jogoTemporadaSelect.addEventListener('change', setSuggestedJornada); 
            jogoClubeCasaInput.addEventListener('change', handleClubeCasaChange);
            jogoClubeForaInput.addEventListener('change', handleClubeForaChange);
        });

        function showStatus(elementId, message, isSuccess) {
            const statusEl = document.getElementById(elementId);
            statusEl.textContent = message;
            statusEl.className = 'status-message ' + (isSuccess ? 'success' : 'error');
            setTimeout(() => { statusEl.textContent = ''; statusEl.className = 'status-message'; }, 5000);
        }

        document.getElementById('formClube').addEventListener('submit', async (e) => { 
            e.preventDefault();
            const nome = document.getElementById('clubeNome').value.trim();
            const logo = document.getElementById('clubeLogo').value.trim();
            const regiao = document.getElementById('clubeRegiao').value.trim();
            const cidade = document.getElementById('clubeCidade').value.trim();
            if (!nome || !logo || !regiao || !cidade) { showStatus('statusClube', 'Todos os campos são obrigatórios.', false); return; }
            try {
                await setDoc(doc(db, "clubes", nome), { nome, logo, regiao, cidade });
                showStatus('statusClube', `Clube "${nome}" adicionado!`, true); e.target.reset();
                allClubes = []; 
                sportingClubeDetalhes = null; 
            } catch (error) { showStatus('statusClube', `Erro: ${error.message}`, false); console.error(error); }
        });

        document.getElementById('formPosicao').addEventListener('submit', async (e) => {
            e.preventDefault();
            const abreviacao = document.getElementById('posicaoAbreviacao').value.trim().toUpperCase();
            const posicao_generica = document.getElementById('posicaoGenericaForm').value.trim();
            if (!abreviacao || !posicao_generica) { showStatus('statusPosicao', 'Todos os campos são obrigatórios.', false); return; }
            try {
                await setDoc(doc(db, "posicoes", abreviacao), { abreviacao, posicao_generica });
                showStatus('statusPosicao', `Posição "${abreviacao}" adicionada!`, true); e.target.reset();
                posicoesMap.clear(); 
                if (document.getElementById('tabJogador').style.display === 'block') loadPosicoesParaDropdown();
            } catch (error) { showStatus('statusPosicao', `Erro: ${error.message}`, false); console.error(error); }
        });
        
        const paisContinenteSelect = document.getElementById('paisContinenteSelect');
        async function loadContinentesParaDropdown() {
            if (allContinentesSet.size > 0 && paisContinenteSelect.options.length > 1 && paisContinenteSelect.options[0].value !== "") return;
            paisContinenteSelect.innerHTML = '<option value="">A carregar continentes...</option>';
            allContinentesSet.clear();
            try {
                const querySnapshot = await getDocs(collection(db, "paises"));
                querySnapshot.forEach((docSnap) => { if (docSnap.data().continente) allContinentesSet.add(docSnap.data().continente); });
                if (allContinentesSet.size === 0) {
                    paisContinenteSelect.innerHTML = '<option value="">Nenhum continente. Adicione um país com continente.</option>';
                } else {
                    paisContinenteSelect.innerHTML = '<option value="">Selecione um Continente</option>';
                    Array.from(allContinentesSet).sort().forEach(c => paisContinenteSelect.add(new Option(c,c)));
                }
            } catch (error) {
                console.error("Erro ao carregar continentes: ", error);
                paisContinenteSelect.innerHTML = '<option value="">Erro ao carregar</option>';
                showStatus('statusPais', 'Erro ao carregar continentes.', false);
            }
        }
        document.getElementById('formPais').addEventListener('submit', async (e) => { 
            e.preventDefault();
            const nome = document.getElementById('paisNome').value.trim();
            const bandeira = document.getElementById('paisBandeira').value.trim();
            const continente = paisContinenteSelect.value; 
            if (!nome || !bandeira || !continente) { showStatus('statusPais', 'Todos os campos são obrigatórios.', false); return; }
            try {
                await setDoc(doc(db, "paises", nome), { nome, bandeira, continente });
                showStatus('statusPais', `País "${nome}" adicionado!`, true); e.target.reset(); 
                paisContinenteSelect.value = ""; allPaises = []; allContinentesSet.clear(); 
                if (document.getElementById('tabJogador').style.display === 'block') loadPaisesParaSugestoes();
                loadContinentesParaDropdown(); 
            } catch (error) { showStatus('statusPais', `Erro: ${error.message}`, false); console.error(error); }
        });

        const posEspecificaDropdown = document.getElementById('jogadorPosEspecifica');
        const posGenericaInput = document.getElementById('jogadorPosGenerica');
        const jogadorPaisNomeInput = document.getElementById('jogadorPaisNome');
        const paisSuggestionsContainer = document.getElementById('paisSuggestions');

        async function loadPosicoesParaDropdown() { 
            if (posicoesMap.size > 0 && posEspecificaDropdown.options.length > 1 && posEspecificaDropdown.options[0].value !== "") return;
            posEspecificaDropdown.innerHTML = '<option value="">A carregar posições...</option>';
            posGenericaInput.value = ''; posicoesMap.clear();
            try {
                const querySnapshot = await getDocs(collection(db, "posicoes"));
                if (querySnapshot.empty) { posEspecificaDropdown.innerHTML = '<option value="">Nenhuma posição. Crie na aba "Criar Posição".</option>'; return; }
                posEspecificaDropdown.innerHTML = '<option value="">Selecione uma Posição</option>';
                querySnapshot.forEach((docSnap) => {
                    const d = docSnap.data(); posicoesMap.set(d.abreviacao, d.posicao_generica);
                    posEspecificaDropdown.add(new Option(d.abreviacao, d.abreviacao));
                });
            } catch (error) {
                console.error("Erro ao carregar posições: ", error);
                posEspecificaDropdown.innerHTML = '<option value="">Erro ao carregar</option>';
                showStatus('statusJogador', 'Erro ao carregar posições.', false);
            }
        }
        posEspecificaDropdown.addEventListener('change', function() { 
            posGenericaInput.value = this.value && posicoesMap.has(this.value) ? posicoesMap.get(this.value) : '';
        });
        async function loadPaisesParaSugestoes() { 
            if (allPaises.length > 0) return; 
            allPaises = []; 
            try {
                const querySnapshot = await getDocs(collection(db, "paises"));
                querySnapshot.forEach((docSnap) => allPaises.push(docSnap.data().nome));
                allPaises.sort(); 
            } catch (error) { console.error("Erro ao carregar países: ", error); showStatus('statusJogador', 'Erro ao carregar países.', false); }
        }
        
        function setupSuggestionHandler(inputElement, suggestionsContainer, dataArray, displayField, imageField = null, clearBtnElement = null) {
            inputElement.addEventListener('input', function() {
                const inputText = this.value.toLowerCase();
                suggestionsContainer.innerHTML = '';
                if (!inputText.trim()) {
                    suggestionsContainer.style.display = 'none';
                    if (inputElement.id === 'jogoClubeCasa' || inputElement.id === 'jogoClubeFora' || (clearBtnElement && inputElement.classList.contains('has-image-bg'))) {
                        inputElement.style.backgroundImage = 'none';
                        inputElement.classList.remove('has-image-bg');
                    }
                    if (clearBtnElement) {
                        clearBtnElement.style.display = 'none';
                        inputElement.classList.remove('has-clear-btn');
                    }
                    return;
                }
                const filteredData = dataArray.filter(item => {
                    const itemText = (typeof item === 'string' ? item : item[displayField]);
                    return itemText ? itemText.toLowerCase().includes(inputText) : false;
                });

                if (filteredData.length > 0) {
                    filteredData.slice(0, 10).forEach(item => {
                        const suggestionItemDiv = document.createElement('div');
                        suggestionItemDiv.classList.add('suggestion-item');
                        const itemText = (typeof item === 'string' ? item : item[displayField]);
                        if (imageField && typeof item === 'object' && item[imageField]) {
                            const img = document.createElement('img'); img.src = item[imageField]; img.alt = itemText;
                            img.onerror = function() { this.style.display='none'; };
                            suggestionItemDiv.appendChild(img);
                        }
                        const textSpan = document.createElement('span'); textSpan.textContent = itemText;
                        suggestionItemDiv.appendChild(textSpan);
                        suggestionItemDiv.addEventListener('click', function() {
                            inputElement.value = itemText; 
                            suggestionsContainer.style.display = 'none';
                            if (imageField && typeof item === 'object' && item[imageField]) {
                                inputElement.style.backgroundImage = `url('${item[imageField]}')`;
                                inputElement.classList.add('has-image-bg');
                            } else {
                                inputElement.style.backgroundImage = 'none';
                                inputElement.classList.remove('has-image-bg');
                            }
                            if (clearBtnElement) {
                                clearBtnElement.style.display = 'block';
                                inputElement.classList.add('has-clear-btn');
                            }
                            inputElement.dispatchEvent(new Event('change', { bubbles: true }));
                        });
                        suggestionsContainer.appendChild(suggestionItemDiv);
                    });
                    suggestionsContainer.style.display = 'block';
                } else { 
                    suggestionsContainer.style.display = 'none'; 
                }
            });
            document.addEventListener('click', (e) => {
                if (!inputElement.contains(e.target) && !suggestionsContainer.contains(e.target)) suggestionsContainer.style.display = 'none';
            });
        }
        setupSuggestionHandler(jogadorPaisNomeInput, paisSuggestionsContainer, allPaises, null);
        
        document.getElementById('formJogador').addEventListener('submit', async (e) => {
            e.preventDefault();
            const nome_jogador = document.getElementById('jogadorNome').value.trim();
            const imagem_link = document.getElementById('jogadorImagem').value.trim();
            const posEspecifica = posEspecificaDropdown.value;
            const posGenerica = posGenericaInput.value;
            const paisNomeForm = jogadorPaisNomeInput.value.trim();
            if (!nome_jogador || !imagem_link || !posEspecifica || !paisNomeForm) { showStatus('statusJogador', 'Todos os campos são obrigatórios.', false); return; }
            if (!posGenerica) { showStatus('statusJogador', 'Posição genérica não definida.', false); return; }
            try {
                await setDoc(doc(db, "jogadores", nome_jogador), { 
                    nome_jogador, imagem_link, posicao_especifica_id: posEspecifica, posicao_especifica_nome: posEspecifica,
                    posicao_generica_id: posGenerica, posicao_generica_nome: posGenerica,
                    pais_id: paisNomeForm, pais_nome: paisNomeForm 
                });
                showStatus('statusJogador', `Jogador "${nome_jogador}" adicionado!`, true); 
                e.target.reset(); posGenericaInput.value = ''; paisSuggestionsContainer.style.display = 'none'; 
                allJogadores = []; 
            } catch (error) { showStatus('statusJogador', `Erro: ${error.message}`, false); console.error(error); }
        });

        const jogoTemporadaSelect = document.getElementById('jogoTemporada');
        const jogoJornadaSelect = document.getElementById('jogoJornada'); 
        const jogoClubeCasaInput = document.getElementById('jogoClubeCasa');
        const clubeCasaSuggestions = document.getElementById('clubeCasaSuggestions');
        const jogoClubeForaInput = document.getElementById('jogoClubeFora');
        const clubeForaSuggestions = document.getElementById('clubeForaSuggestions');
        const jogoMinutoGoloMarcadoInput = document.getElementById('jogoMinutoGoloMarcadoInput');
        const addMinutoGoloMarcadoBtn = document.getElementById('addMinutoGoloMarcadoBtn');
        const listaMinutosGolosMarcados = document.getElementById('listaMinutosGolosMarcados');
        const jogoMinutoGoloSofridoInput = document.getElementById('jogoMinutoGoloSofridoInput');
        const addMinutoGoloSofridoBtn = document.getElementById('addMinutoGoloSofridoBtn');
        const listaMinutosGolosSofridos = document.getElementById('listaMinutosGolosSofridos');
        const jogoGMCasa = document.getElementById('jogoGMCasa');
        const jogoGMFora = document.getElementById('jogoGMFora');
        const jogoGSCasa = document.getElementById('jogoGSCasa');
        const jogoGSFora = document.getElementById('jogoGSFora');
        const jogoMarcados1P = document.getElementById('jogoMarcados1P');
        const jogoMarcados2P = document.getElementById('jogoMarcados2P');
        const jogoSofridos1P = document.getElementById('jogoSofridos1P');
        const jogoSofridos2P = document.getElementById('jogoSofridos2P');
        const jogoEstado = document.getElementById('jogoEstado');
        const jogoNomeJogo = document.getElementById('jogoNomeJogo'); 
        const jogoResultadoFinal = document.getElementById('jogoResultadoFinal');
        const goalDetailModal = document.getElementById('goalDetailModal');
        const closeGoalDetailModalBtn = document.getElementById('closeGoalDetailModalBtn');
        const goalDetailModalTitle = document.getElementById('goalDetailModalTitle');
        const formGoalDetail = document.getElementById('formGoalDetail');
        const goalDetailTypeInput = document.getElementById('goalDetailType');
        const goalDetailMinuteInput = document.getElementById('goalDetailMinute');
        const goalDetailScorerSection = document.getElementById('goalDetailScorerSection');
        const goalDetailJogadorInput = document.getElementById('goalDetailJogador');
        const goalDetailJogadorSuggestions = document.getElementById('goalDetailJogadorSuggestions');
        const goalZoneGridContainer = document.getElementById('goalZoneGridContainer');
        const selectedGoalZoneHidden = document.getElementById('selectedGoalZoneHidden');
        const goalDetailAssistenciaSection = document.getElementById('goalDetailAssistenciaSection');
        const goalDetailAssistenciaInput = document.getElementById('goalDetailAssistencia');
        const goalDetailAssistenciaSuggestions = document.getElementById('goalDetailAssistenciaSuggestions');
        const saveGoalDetailBtn = document.getElementById('saveGoalDetailBtn');

        function populateTemporadaDropdown() {
            if (jogoTemporadaSelect.options.length > 1) return;
            jogoTemporadaSelect.innerHTML = '<option value="">Selecione a Temporada</option>';
            const currentYear = new Date().getFullYear();
            for (let year = currentYear + 1; year >= 2000; year--) {
                const displayTemporada = `${year-1}/${year}`;
                jogoTemporadaSelect.add(new Option(displayTemporada, displayTemporada));
            }
        }
        
        async function setSuggestedJornada() {
            const selectedTemporadaValue = jogoTemporadaSelect.value;
            if (!selectedTemporadaValue) {
                jogoTerminadoCheckbox.checked = false;
            } else {
                const options = Array.from(jogoTemporadaSelect.options);
                const firstSelectableOption = options.find(opt => opt.value !== "");
                if (firstSelectableOption) {
                    const mostRecentSeasonInDropdown = firstSelectableOption.value;
                    if (selectedTemporadaValue < mostRecentSeasonInDropdown) {
                        jogoTerminadoCheckbox.checked = true;
                    } else {
                        jogoTerminadoCheckbox.checked = false;
                    }
                } else {
                     jogoTerminadoCheckbox.checked = false;
                }
            }
            syncGameStatusCheckboxes(); 

            if (jogoJornadaSelect.options.length <= 1 || (jogoJornadaSelect.options.length > 0 && jogoJornadaSelect.options[0].value === "")) {
                const currentJornadaVal = jogoJornadaSelect.value;
                jogoJornadaSelect.innerHTML = '<option value="">A carregar jornadas...</option>';
                for (let i = 1; i <= 40; i++) {
                    jogoJornadaSelect.add(new Option(i.toString(), i.toString()));
                }
                if (currentJornadaVal && !isNaN(parseInt(currentJornadaVal)) && parseInt(currentJornadaVal) >=1 && parseInt(currentJornadaVal) <=40) {
                    jogoJornadaSelect.value = currentJornadaVal;
                } else {
                     jogoJornadaSelect.value = ""; 
                }
                if (jogoJornadaSelect.value === "") {
                    jogoJornadaSelect.options[0].textContent = "Selecione a Jornada";
                } else {
                    if(jogoJornadaSelect.options[0].value === "") jogoJornadaSelect.options[0].textContent = "Selecione a Jornada";
                }
            }
            if (!selectedTemporadaValue) {
                if (jogoJornadaSelect.value === "" && jogoJornadaSelect.options.length > 0 && jogoJornadaSelect.options[0].value === "") {
                     jogoJornadaSelect.options[0].textContent = "Selecione a Jornada";
                }
                return; 
            }
            const originalJornadaPlaceholder = jogoJornadaSelect.options[0].value === "" ? jogoJornadaSelect.options[0].textContent : null;
            if (jogoJornadaSelect.options[0].value === "") {
                 jogoJornadaSelect.options[0].textContent = "A calcular...";
            }
            try {
                const q = query(collection(db, "jogos"), where("temporada", "==", selectedTemporadaValue));
                const querySnapshot = await getDocs(q);
                let maxJornada = 0;
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data.jornada != null && !isNaN(Number(data.jornada)) && Number(data.jornada) > maxJornada) {
                        maxJornada = Number(data.jornada);
                    }
                });
                const nextJornada = maxJornada + 1;
                const suggestedJornadaValue = Math.min(nextJornada, 40); 
                if (jogoJornadaSelect.querySelector(`option[value="${suggestedJornadaValue.toString()}"]`)) {
                    jogoJornadaSelect.value = suggestedJornadaValue.toString();
                } else if (jogoJornadaSelect.options.length > 1) { 
                     jogoJornadaSelect.value = jogoJornadaSelect.options[1].value; 
                } else {
                    jogoJornadaSelect.value = ""; 
                }
            } catch (error) {
                console.error("Erro ao sugerir próxima jornada:", error);
                showStatus('statusJogo', 'Erro ao calcular jornada. Selecione manualmente.', false);
            } finally {
                 if (jogoJornadaSelect.options[0].value === "" && (jogoJornadaSelect.options[0].textContent.includes("calcular") || jogoJornadaSelect.options[0].textContent.includes("carregar")) ) {
                     if (jogoJornadaSelect.value === "") { 
                        jogoJornadaSelect.options[0].textContent = originalJornadaPlaceholder || "Selecione a Jornada";
                     } else {
                        if (jogoJornadaSelect.options[0].value === "") jogoJornadaSelect.options[0].textContent = "Selecione a Jornada";
                     }
                }
            }
        }

        async function loadClubesParaJogo() {
            if (allClubes.length > 0 && sportingClubeDetalhes) { 
                 setupSuggestionHandler(jogoClubeCasaInput, clubeCasaSuggestions, allClubes, 'nome', 'logo');
                 setupSuggestionHandler(jogoClubeForaInput, clubeForaSuggestions, allClubes, 'nome', 'logo');
                return;
            }
            allClubes = [];
            sportingClubeDetalhes = null;
            try {
                const snap = await getDocs(collection(db, "clubes"));
                snap.forEach(s => allClubes.push({ id: s.id, nome: s.data().nome, logo: s.data().logo }));
                allClubes.sort((a, b) => a.nome.localeCompare(b.nome));
                
                sportingClubeDetalhes = allClubes.find(c => c.nome.toLowerCase() === SPORTING_CP_CANONICAL_NAME.toLowerCase());
                if (!sportingClubeDetalhes) {
                    sportingClubeDetalhes = allClubes.find(c => sportingCanonicoNomesInputCheck.includes(c.nome.toLowerCase()));
                }
                if (!sportingClubeDetalhes) {
                     console.warn("Detalhes do Sporting CP não foram encontrados na lista de clubes.");
                }

                setupSuggestionHandler(jogoClubeCasaInput, clubeCasaSuggestions, allClubes, 'nome', 'logo');
                setupSuggestionHandler(jogoClubeForaInput, clubeForaSuggestions, allClubes, 'nome', 'logo');
            } catch (e) { console.error("Erro loadClubes: ", e); showStatus('statusJogo', 'Erro lista de clubes.', false); }
        }
        
        function handleClubeCasaChange() {
            if (!sportingClubeDetalhes) return;
            const casaNome = jogoClubeCasaInput.value.trim();
            const foraNome = jogoClubeForaInput.value.trim();

            if (casaNome && !sportingCanonicoNomesInputCheck.includes(casaNome.toLowerCase())) {
                jogoClubeForaInput.value = sportingClubeDetalhes.nome;
                if (sportingClubeDetalhes.logo) {
                    jogoClubeForaInput.style.backgroundImage = `url('${sportingClubeDetalhes.logo}')`;
                    jogoClubeForaInput.classList.add('has-image-bg');
                } else {
                    jogoClubeForaInput.style.backgroundImage = 'none';
                    jogoClubeForaInput.classList.remove('has-image-bg');
                }
            } else if (casaNome && sportingCanonicoNomesInputCheck.includes(casaNome.toLowerCase())) {
                if (foraNome && sportingCanonicoNomesInputCheck.includes(foraNome.toLowerCase())) {
                    jogoClubeForaInput.value = "";
                    jogoClubeForaInput.style.backgroundImage = 'none';
                    jogoClubeForaInput.classList.remove('has-image-bg');
                }
            }
            updateCalculatedScores();
        }

        function handleClubeForaChange() {
            if (!sportingClubeDetalhes) return;
            const casaNome = jogoClubeCasaInput.value.trim();
            const foraNome = jogoClubeForaInput.value.trim();

            if (foraNome && !sportingCanonicoNomesInputCheck.includes(foraNome.toLowerCase())) {
                jogoClubeCasaInput.value = sportingClubeDetalhes.nome;
                if (sportingClubeDetalhes.logo) {
                    jogoClubeCasaInput.style.backgroundImage = `url('${sportingClubeDetalhes.logo}')`;
                    jogoClubeCasaInput.classList.add('has-image-bg');
                } else {
                    jogoClubeCasaInput.style.backgroundImage = 'none';
                    jogoClubeCasaInput.classList.remove('has-image-bg');
                }
            } else if (foraNome && sportingCanonicoNomesInputCheck.includes(foraNome.toLowerCase())) {
                if (casaNome && sportingCanonicoNomesInputCheck.includes(casaNome.toLowerCase())) {
                    jogoClubeCasaInput.value = "";
                    jogoClubeCasaInput.style.backgroundImage = 'none';
                    jogoClubeCasaInput.classList.remove('has-image-bg');
                }
            }
            updateCalculatedScores();
        }


        async function loadJogadoresParaJogo() {
            if (allJogadores.length > 0) { 
                setupSuggestionHandler(goalDetailJogadorInput, goalDetailJogadorSuggestions, allJogadores, 'nome', 'imagem_link');
                setupSuggestionHandler(goalDetailAssistenciaInput, goalDetailAssistenciaSuggestions, allJogadores, 'nome', 'imagem_link');
                return;
            }
            allJogadores = []; 
            try {
                const snap = await getDocs(collection(db, "jogadores"));
                snap.forEach(s => allJogadores.push({ id: s.id, nome: s.data().nome_jogador, imagem_link: s.data().imagem_link }));
                allJogadores.sort((a, b) => a.nome.localeCompare(b.nome));
                setupSuggestionHandler(goalDetailJogadorInput, goalDetailJogadorSuggestions, allJogadores, 'nome', 'imagem_link');
                setupSuggestionHandler(goalDetailAssistenciaInput, goalDetailAssistenciaSuggestions, allJogadores, 'nome', 'imagem_link');
            } catch (e) { console.error("Erro loadJogadores: ", e); showStatus('statusJogo', 'Erro lista de jogadores.', false); }
        }

        function getGoalDetailStatus(details, type) {
            if (!details || Object.keys(details).length === 0 || (!details.jogadorNome && !details.zona && !details.assistenciaNome && type === 'marcado') || (!details.zona && type === 'sofrido')) {
                return 'status-pending';
            }
            if (type === 'marcado') {
                const hasScorer = !!details.jogadorNome; const hasZone = !!details.zona;
                if (hasScorer && hasZone) return 'status-complete';
                else if (hasScorer || hasZone) return 'status-incomplete';
            } else if (type === 'sofrido') {
                if (details.zona) return 'status-complete';
            }
            return 'status-pending';
        }

        function renderMinuteList(listElement, minutesArray, type) {
            listElement.innerHTML = '';
            minutesArray.forEach((entry, index) => {
                const listItem = document.createElement('li');
                listItem.classList.add('minute-list-item');
                const statusClass = getGoalDetailStatus(entry.details, type);
                listItem.classList.add(statusClass);
                
                const textAndScorerContainer = document.createElement('div');
                textAndScorerContainer.classList.add('minute-text-scorer-container');

                const minuteSpan = document.createElement('span');
                minuteSpan.classList.add('minute-value');
                minuteSpan.textContent = `Minuto ${entry.minute}`;
                minuteSpan.dataset.index = index;
                minuteSpan.dataset.type = type; 
                minuteSpan.dataset.minute = entry.minute; 
                minuteSpan.addEventListener('click', openGoalDetailModal);
                textAndScorerContainer.appendChild(minuteSpan);

                if (type === 'marcado' && entry.details && entry.details.jogadorNome) {
                    const separatorSpan = document.createElement('span');
                    separatorSpan.classList.add('minute-list-separator');
                    separatorSpan.textContent = " | ";
                    textAndScorerContainer.appendChild(separatorSpan);

                    const jogador = allJogadores.find(j => j.nome === entry.details.jogadorNome);
                    if (jogador && jogador.imagem_link) {
                        const imgJogador = document.createElement('img');
                        imgJogador.src = jogador.imagem_link;
                        imgJogador.alt = entry.details.jogadorNome;
                        imgJogador.classList.add('minute-list-player-image');
                        textAndScorerContainer.appendChild(imgJogador);
                    }

                    const scorerSpan = document.createElement('span');
                    scorerSpan.classList.add('scorer-name');
                    scorerSpan.textContent = entry.details.jogadorNome; 
                    textAndScorerContainer.appendChild(scorerSpan);
                }

                const removeBtn = document.createElement('button');
                removeBtn.classList.add('remove-minute-btn');
                removeBtn.innerHTML = '×';
                removeBtn.addEventListener('click', () => {
                    minutesArray.splice(index, 1);
                    renderMinuteList(listElement, minutesArray, type); 
                    updateCalculatedScores();
                });

                listItem.appendChild(textAndScorerContainer);
                listItem.appendChild(removeBtn);
                listElement.appendChild(listItem);
            });
        }
        function addMinuteEntry(type, listElement, minutesArray) {
            const minuteInputEl = type === 'marcado' ? jogoMinutoGoloMarcadoInput : jogoMinutoGoloSofridoInput;
            const minute = parseInt(minuteInputEl.value);
            if (!minute || minute <= 0) { showStatus('statusJogo', 'Minuto inválido.', false); return; }
            minutesArray.push({ minute, details: {} });
            minutesArray.sort((a, b) => a.minute - b.minute);
            renderMinuteList(listElement, minutesArray, type);
            minuteInputEl.value = ''; updateCalculatedScores();
        }
        addMinutoGoloMarcadoBtn.addEventListener('click', () => addMinuteEntry('marcado', listaMinutosGolosMarcados, minutosGolosMarcados));
        addMinutoGoloSofridoBtn.addEventListener('click', () => addMinuteEntry('sofrido', listaMinutosGolosSofridos, minutosGolosSofridos));

        function populateGoalZoneGrid() {
            if (goalZoneGridContainer.children.length > 0) return;
            goalZoneNames.forEach(zoneName => {
                const cell = document.createElement('div'); cell.classList.add('goal-zone-cell');
                cell.textContent = zoneName; cell.dataset.zone = zoneName;
                cell.addEventListener('click', handleZoneSelection); goalZoneGridContainer.appendChild(cell);
            });
        }
        function handleZoneSelection(event) {
            const selectedCell = event.target;
            goalZoneGridContainer.querySelectorAll('.goal-zone-cell').forEach(cell => cell.classList.remove('selected'));
            selectedCell.classList.add('selected'); selectedGoalZoneHidden.value = selectedCell.dataset.zone;
        }

        function openGoalDetailModal(event) {
            const type = event.target.dataset.type; const index = parseInt(event.target.dataset.index);
            const minuteEntry = type === 'marcado' ? minutosGolosMarcados[index] : minutosGolosSofridos[index];
            goalDetailTypeInput.value = type; goalDetailMinuteInput.value = minuteEntry.minute;
            goalDetailModalTitle.textContent = `Detalhes do Golo - Minuto ${minuteEntry.minute} (${type})`;
            formGoalDetail.reset(); selectedGoalZoneHidden.value = '';
            goalZoneGridContainer.querySelectorAll('.goal-zone-cell').forEach(cell => cell.classList.remove('selected'));
            
            goalDetailJogadorInput.style.backgroundImage = 'none';
            goalDetailJogadorInput.classList.remove('has-image-bg');
            goalDetailAssistenciaInput.style.backgroundImage = 'none';
            goalDetailAssistenciaInput.classList.remove('has-image-bg');

            goalDetailJogadorInput.value = minuteEntry.details?.jogadorNome || '';
            if (minuteEntry.details?.jogadorNome && allJogadores.length > 0) {
                const scorerDetails = allJogadores.find(j => j.nome === minuteEntry.details.jogadorNome);
                if (scorerDetails && scorerDetails.imagem_link) {
                    goalDetailJogadorInput.style.backgroundImage = `url('${scorerDetails.imagem_link}')`;
                    goalDetailJogadorInput.classList.add('has-image-bg');
                }
            }
            goalDetailAssistenciaInput.value = minuteEntry.details?.assistenciaNome || '';
             if (minuteEntry.details?.assistenciaNome && allJogadores.length > 0) {
                const assisterDetails = allJogadores.find(j => j.nome === minuteEntry.details.assistenciaNome);
                if (assisterDetails && assisterDetails.imagem_link) {
                    goalDetailAssistenciaInput.style.backgroundImage = `url('${assisterDetails.imagem_link}')`;
                    goalDetailAssistenciaInput.classList.add('has-image-bg');
                }
            }
            if (minuteEntry.details?.zona) {
                selectedGoalZoneHidden.value = minuteEntry.details.zona;
                const preSelected = goalZoneGridContainer.querySelector(`.goal-zone-cell[data-zone="${minuteEntry.details.zona}"]`);
                if (preSelected) preSelected.classList.add('selected');
            }
            goalDetailScorerSection.style.display = type === 'marcado' ? 'block' : 'none';
            goalDetailAssistenciaSection.style.display = type === 'marcado' ? 'block' : 'none';
            goalDetailModal.style.display = 'block';
        }
        closeGoalDetailModalBtn.onclick = () => goalDetailModal.style.display = 'none';

        saveGoalDetailBtn.addEventListener('click', () => {
            const type = goalDetailTypeInput.value; const minute = parseInt(goalDetailMinuteInput.value);
            let targetArray = type === 'marcado' ? minutosGolosMarcados : minutosGolosSofridos;
            const entry = targetArray.find(e => e.minute === minute);
            if (!entry) { showStatus('statusJogo', 'Erro ao encontrar golo.', false); return; }
            entry.details = {
                jogadorNome: goalDetailJogadorInput.value.trim() || null,
                zona: selectedGoalZoneHidden.value || null,
                assistenciaNome: goalDetailAssistenciaInput.value.trim() || null,
            };
            const scorer = allJogadores.find(j => j.nome === entry.details.jogadorNome);
            if(scorer) entry.details.jogadorId = scorer.id;
            const assister = allJogadores.find(j => j.nome === entry.details.assistenciaNome);
            if(assister) entry.details.assistenciaId = assister.id;
            showStatus('statusJogo', `Detalhes para golo aos ${minute}' guardados.`, true);
            goalDetailModal.style.display = 'none';
            if (type === 'marcado') renderMinuteList(listaMinutosGolosMarcados, minutosGolosMarcados, 'marcado');
            else renderMinuteList(listaMinutosGolosSofridos, minutosGolosSofridos, 'sofrido');
        });

        function updateCalculatedScores() {
            const casaNomeInput = jogoClubeCasaInput.value.trim(); 
            const foraNomeInput = jogoClubeForaInput.value.trim(); 
            const casaNomeLower = casaNomeInput.toLowerCase();
            const foraNomeLower = foraNomeInput.toLowerCase();
            
            const isSportingCasa = sportingCanonicoNomesInputCheck.includes(casaNomeLower);
            const isSportingFora = sportingCanonicoNomesInputCheck.includes(foraNomeLower);

            const gMarcadosPeloSporting = minutosGolosMarcados.length;
            const gSofridosPeloSporting = minutosGolosSofridos.length;
            
            let gmCasaFinal, gmForaFinal, gsCasaFinal, gsForaFinal;

            if (isSportingCasa) {
                gmCasaFinal = gMarcadosPeloSporting; 
                gmForaFinal = gSofridosPeloSporting; 
                gsCasaFinal = gSofridosPeloSporting; 
                gsForaFinal = gMarcadosPeloSporting; 
            } else if (isSportingFora) {
                gmCasaFinal = gSofridosPeloSporting; 
                gmForaFinal = gMarcadosPeloSporting; 
                gsCasaFinal = gMarcadosPeloSporting; 
                gsForaFinal = gSofridosPeloSporting; 
            } else { 
                if (isSportingCasa && !foraNomeInput) { 
                    gmCasaFinal = gMarcadosPeloSporting;
                    gmForaFinal = gSofridosPeloSporting; 
                    gsCasaFinal = gSofridosPeloSporting;
                    gsForaFinal = gMarcadosPeloSporting;
                } else if (isSportingFora && !casaNomeInput) { 
                     gmForaFinal = gMarcadosPeloSporting;
                     gmCasaFinal = gSofridosPeloSporting; 
                     gsForaFinal = gSofridosPeloSporting;
                     gsCasaFinal = gMarcadosPeloSporting;
                } else if (!casaNomeInput && !foraNomeInput) { 
                    gmCasaFinal = 0; gmForaFinal = 0; gsCasaFinal = 0; gsForaFinal = 0;
                } else if ((casaNomeInput && !isSportingCasa) && (foraNomeInput && !isSportingFora)) {
                    gmCasaFinal = 0; gmForaFinal = 0; gsCasaFinal = 0; gsForaFinal = 0;
                } else { 
                    gmCasaFinal = 0; gmForaFinal = 0; gsCasaFinal = 0; gsForaFinal = 0;
                }
            }
            
            jogoGMCasa.value = gmCasaFinal; 
            jogoGMFora.value = gmForaFinal;
            jogoGSCasa.value = gsCasaFinal; 
            jogoGSFora.value = gsForaFinal;

            jogoResultadoFinal.value = `${gmCasaFinal}-${gmForaFinal}`;
            if (jogoFuturoCheckbox.checked) {
                // If "Futuro" checkbox is checked
                if (casaNomeInput && foraNomeInput) {
                    jogoNomeJogo.value = `${casaNomeInput} x ${foraNomeInput}`;
                } else if (casaNomeInput) {
                    // Consistent with existing display for partial names if "Futuro"
                    jogoNomeJogo.value = `${casaNomeInput} vs ?`;
                } else if (foraNomeInput) {
                    // Consistent with existing display for partial names if "Futuro"
                    jogoNomeJogo.value = `? vs ${foraNomeInput}`;
                } else {
                    jogoNomeJogo.value = "";
                }
            } else {
                // Original logic for non-futuro games (e.g., Live, Terminado)
                // or when "Futuro" is not the primary active state.
                jogoNomeJogo.value = (casaNomeInput && foraNomeInput) ? `${casaNomeInput} ${gmCasaFinal}-${gmForaFinal} ${foraNomeInput}` : (casaNomeInput ? `${casaNomeInput} vs ?` : (foraNomeInput ? `? vs ${foraNomeInput}`: ""));
            }                        
            jogoMarcados1P.value = minutosGolosMarcados.filter(g => g.minute <= 45).length;
            jogoMarcados2P.value = minutosGolosMarcados.filter(g => g.minute > 45).length;
            jogoSofridos1P.value = minutosGolosSofridos.filter(g => g.minute <= 45).length;
            jogoSofridos2P.value = minutosGolosSofridos.filter(g => g.minute > 45).length;

            if (!isSportingCasa && !isSportingFora && (casaNomeInput || foraNomeInput)) {
                 jogoEstado.value = "N/A (Sporting não joga)";
            } else if (gMarcadosPeloSporting > gSofridosPeloSporting) {
                jogoEstado.value = "V (Vitória)";
            } else if (gMarcadosPeloSporting < gSofridosPeloSporting) {
                jogoEstado.value = "D (Derrota)";
            } else { 
                jogoEstado.value = "E (Empate)";
            }
        }
        
        function setupDynamicPlayerInputs(containerId, numPlayers, rolePrefix) {
            const container = document.getElementById(containerId); 
            container.innerHTML = ''; 
            for (let i = 1; i <= numPlayers; i++) {
                const wrapperDiv = document.createElement('div'); 
                wrapperDiv.classList.add('player-input-wrapper');
                const inputId = `${containerId}_${rolePrefix}_${i}`;
                const input = document.createElement('input');
                input.type = 'text'; input.id = inputId;
                input.placeholder = `Jogador ${i}`; input.autocomplete = 'off'; input.dataset.playerType = rolePrefix;
                const suggId = `${containerId}_sugg_${rolePrefix}_${i}`;
                const suggDiv = document.createElement('div');
                suggDiv.id = suggId; suggDiv.classList.add('suggestions-container'); suggDiv.style.display = 'none';
                const clearBtn = document.createElement('span'); 
                clearBtn.classList.add('player-input-clear-btn'); clearBtn.innerHTML = '×'; clearBtn.style.display = 'none'; 
                clearBtn.addEventListener('click', function() {
                    input.value = ''; input.style.backgroundImage = 'none';
                    input.classList.remove('has-image-bg'); input.classList.remove('has-clear-btn'); 
                    this.style.display = 'none'; 
                    input.dispatchEvent(new Event('input', { bubbles: true })); 
                });
                input.addEventListener('input', function() { 
                    if (this.value.trim() !== '') {
                        clearBtn.style.display = 'block'; input.classList.add('has-clear-btn');
                    } else {
                        clearBtn.style.display = 'none'; input.classList.remove('has-clear-btn');
                        input.style.backgroundImage = 'none'; input.classList.remove('has-image-bg');
                    }
                });
                wrapperDiv.appendChild(input); wrapperDiv.appendChild(clearBtn); 
                wrapperDiv.appendChild(suggDiv); 
                container.appendChild(wrapperDiv);
                if (allJogadores.length > 0) {
                    setupSuggestionHandler(input, suggDiv, allJogadores, 'nome', 'imagem_link', clearBtn); 
                }
            }
        }
        
        document.getElementById('formJogo').addEventListener('submit', async (e) => {
            e.preventDefault(); const statusEl = 'statusJogo';
            const temporada = jogoTemporadaSelect.value;
            const jornada = jogoJornadaSelect.value; 
            const clubeCasaNome = jogoClubeCasaInput.value.trim();
            const clubeForaNome = jogoClubeForaInput.value.trim();
            
            const isSportingCasa = sportingCanonicoNomesInputCheck.includes(clubeCasaNome.toLowerCase());
            const isSportingFora = sportingCanonicoNomesInputCheck.includes(clubeForaNome.toLowerCase());

            if (!temporada || !jornada || !clubeCasaNome || !clubeForaNome) { showStatus(statusEl, 'Temp., Jornada, Clubes obrigatórios.', false); return; }
            if (!isSportingCasa && !isSportingFora) { showStatus(statusEl, `Um dos clubes deve ser '${SPORTING_CP_CANONICAL_NAME}' ou variante.`, false); return; }
            if (clubeCasaNome.toLowerCase() === clubeForaNome.toLowerCase()) { showStatus(statusEl, 'Clubes devem ser diferentes.', false); return; }

            const getPlantel = (containerSel) => Array.from(document.querySelectorAll(`${containerSel} input[type="text"]`))
                .map(inp => {
                    const nome = inp.value.trim();
                    if (!nome) return { nome: null, id: null }; 
                    const jogador = allJogadores.find(j => j.nome === nome);
                    return { nome, id: jogador ? jogador.id : nome }; 
                }).filter(p => p.nome); 

            const jogoData = {
                temporada, jornada: parseInt(jornada), 
                nomeJogo: jogoNomeJogo.value, clubeCasaNome, clubeForaNome, 
                sportingCasa: isSportingCasa, 
                golosMarcadosSportingMinutos: minutosGolosMarcados.map(g => ({ minute: g.minute, details: g.details || {} })),
                golosSofridosSportingMinutos: minutosGolosSofridos.map(g => ({ minute: g.minute, details: g.details || {} })),
                resultadoFinal: jogoResultadoFinal.value, 
                resultadoGMCasa: parseInt(jogoGMCasa.value) || 0, 
                resultadoGMFora: parseInt(jogoGMFora.value) || 0,
                sportingGolosMarcados1P: parseInt(jogoMarcados1P.value) || 0, 
                sportingGolosMarcados2P: parseInt(jogoMarcados2P.value) || 0,
                sportingGolosSofridos1P: parseInt(jogoSofridos1P.value) || 0, 
                sportingGolosSofridos2P: parseInt(jogoSofridos2P.value) || 0,
                resultadoEstadoSporting: jogoEstado.value,
                onzeInicial: getPlantel('#jogo11InicialContainer'), 
                suplentes: getPlantel('#jogoSuplentesContainer'),
                jogoLive: jogoLiveCheckbox.checked,
                jogoTerminado: jogoTerminadoCheckbox.checked,
                jogoFuturo: jogoFuturoCheckbox.checked,
                dataCriacao: serverTimestamp()
            };

            try {
                const docRef = await addDoc(collection(db, "jogos"), jogoData);
                showStatus(statusEl, `Jogo adicionado ID: ${docRef.id}!`, true);
                const currentTemporada = jogoTemporadaSelect.value; 
                e.target.reset(); 
                
                jogoClubeCasaInput.style.backgroundImage = 'none';
                jogoClubeCasaInput.classList.remove('has-image-bg');
                jogoClubeForaInput.style.backgroundImage = 'none';
                jogoClubeForaInput.classList.remove('has-image-bg');

                document.querySelectorAll('#jogo11InicialContainer .player-input-wrapper input, #jogoSuplentesContainer .player-input-wrapper input, #goalDetailModal input.has-image-bg')
                    .forEach(input => {
                        input.style.backgroundImage = 'none';
                        input.classList.remove('has-image-bg');
                        input.classList.remove('has-clear-btn');
                        const clearBtn = input.parentElement.querySelector('.player-input-clear-btn');
                        if(clearBtn) clearBtn.style.display = 'none';
                    });
                minutosGolosMarcados = []; minutosGolosSofridos = [];
                renderMinuteList(listaMinutosGolosMarcados, minutosGolosMarcados, 'marcado');
                renderMinuteList(listaMinutosGolosSofridos, minutosGolosSofridos, 'sofrido');
                setupDynamicPlayerInputs('jogo11InicialContainer', 11, 'inicial'); 
                setupDynamicPlayerInputs('jogoSuplentesContainer', 11, 'suplente');
                
                updateCalculatedScores(); 
                syncGameStatusCheckboxes.call(window); 
                
                if (currentTemporada) jogoTemporadaSelect.value = currentTemporada;
                else jogoTemporadaSelect.value = ""; 
                setSuggestedJornada(); 

            } catch (error) { showStatus(statusEl, `Erro: ${error.message}`, false); console.error(error); }
        });
    </script>
</body>
</html>
