<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão Firebase - Editar</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa; 
            color: #343a40; 
            line-height: 1.7;
            font-size: 17px; 
        }
        .container {
            width: 85%; 
            margin: 30px auto; 
            padding: 30px; 
            background: #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.12); 
            border-radius: 12px; 
        }
        h1 {
            color: #0056b3; 
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.8em; 
            font-weight: 700;
        }
        /* Estilos para h2, form, fieldset, label, input, button, .status-message, 
           .suggestions-container, .modal etc. são os mesmos da versão completa.
           Apenas a estrutura de navegação principal muda. */

        .tab-navigation {
            display: flex; 
            flex-wrap: wrap; 
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 30px; 
        }
        .tab-navigation button { 
            background-color: #e9ecef; 
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 18px; 
            transition: background-color 0.3s ease, color 0.3s ease;
            font-size: 1.05em; 
            border-radius: 8px 8px 0 0; 
            margin-right: 5px; 
            margin-bottom: -1px; 
            color: #495057; 
            font-weight: 500;
        }
        .tab-navigation button:hover {
            background-color: #ced4da; 
            color: #0056b3;
        }
        .tab-navigation button.active {
            background-color: #007bff; 
            color: white;
            border-bottom: 1px solid #007bff; 
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1) inset;
        }
        .tab-content {
            display: none; 
            padding: 20px; 
            border-top: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(10px);}
            to {opacity: 1; transform: translateY(0);}
        }
        form { 
            display: flex;
            flex-direction: column;
            gap: 25px; 
        }
        form div, form fieldset { 
            display: flex;
            flex-direction: column;
            position: relative;
            gap: 8px; 
        }
        
        label { 
            margin-bottom: 0px; 
            font-weight: 500;
            font-size: 1.1em; 
            color: #495057;
        }
        input[type="text"], input[type="url"], input[type="number"], select { 
            padding: 12px; 
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1em; 
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        input[type="text"]:focus, input[type="url"]:focus, input[type="number"]:focus, select:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
            outline: none;
        }
        input[readonly] { 
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        button[type="submit"], .action-button { 
            background-color: #28a745; /* Default Green for save */
            color: white;
            padding: 12px 20px; 
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.05em; 
            align-self: flex-start;
            transition: background-color 0.2s ease, transform 0.1s ease;
            font-weight: 500;
        }
        button[type="submit"]:hover, .action-button:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }
        .action-button.secondary { background-color: #6c757d; }
        .action-button.secondary:hover { background-color: #5a6268; }
        .action-button.danger { background-color: #dc3545; } /* Red for delete */
        .action-button.danger:hover { background-color: #c82333; }

        .status-message {
            margin-top: 20px; padding: 15px; border-radius: 6px; font-size: 1em; font-weight: 500;
        }
        .status-message.success { background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
        .status-message.error { background-color: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }
        
        .suggestions-container {
            position: absolute; border: 1px solid #ced4da; border-top: none; z-index: 99;
            top: 100%; left: 0; right: 0; background-color: white; max-height: 180px;
            overflow-y: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 0 0 6px 6px;
        }
        .suggestion-item { 
            padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 1em;
            display: flex; flex-direction: row; align-items: center; 
        }
        .suggestion-item img {
            width: 30px; height: 30px; object-fit: contain; margin-right: 10px;
            border-radius: 50%; border: 1px solid #ddd; flex-shrink: 0;
        }
        .suggestion-item span { flex-grow: 1; line-height: 1.4; }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover { background-color: #f0f8ff; color: #0056b3; }

        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe; margin: 10% auto; padding: 25px; border: 1px solid #888;
            width: 60%; max-width: 550px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .modal-content h3 { margin-top: 0; color: #007bff; }
        .modal-close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .modal-close-btn:hover, .modal-close-btn:focus { color: black; text-decoration: none; cursor: pointer; }
        
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
         @media (min-width: 600px) {
            .form-grid.two-cols { grid-template-columns: 1fr 1fr; }
            .form-grid.three-cols { grid-template-columns: repeat(3, 1fr); align-items: end; }
        }
        
        .tab-content[id^="tabEdit"] h2 { 
            color: #007bff; border-bottom: 2px solid #007bff;
            padding-bottom: 15px; margin-bottom: 30px; font-size: 2.2em; 
        }
        .tab-content[id^="tabEdit"] form { gap: 30px; }
        .tab-content[id^="tabEdit"] fieldset {
            border: 1px solid #ced4da; border-radius: 10px; padding: 25px; 
            background-color: #ffffff; box-shadow: 0 2px 8px rgba(0,0,0,0.07); 
        }
        /* Fieldset styling for Editar Jogo (similar to Criar Jogo) */
        #tabEditJogo fieldset:nth-of-type(1) { border-left: 5px solid #17a2b8; background-color: #f8f9fa; }
        #tabEditJogo fieldset:nth-of-type(1) legend { color: #17a2b8; }
        #tabEditJogo fieldset:nth-of-type(2) { border-left: 5px solid #28a745; }
        #tabEditJogo fieldset:nth-of-type(2) legend { color: #28a745; }
        #tabEditJogo fieldset#fieldsetEditPlacarStats { border-left: 5px solid #ffc107; background-color: #fdf8e2; }
        #tabEditJogo fieldset#fieldsetEditPlacarStats.open { background-color: #f8f9fa; }
        #tabEditJogo fieldset#fieldsetEditPlacarStats legend#legendEditPlacarStats { color: #c89400; }
        #tabEditJogo fieldset:nth-of-type(4) { border-left: 5px solid #6f42c1; }
        #tabEditJogo fieldset:nth-of-type(4) legend { color: #6f42c1; }

        .tab-content[id^="tabEdit"] legend { font-size: 1.6em; font-weight: 600; padding: 0 15px; margin-bottom: 15px; }
        .tab-content[id^="tabEdit"] label { font-size: 1.2em; color: #343a40; margin-bottom: 8px; }
        .tab-content[id^="tabEdit"] input[type="text"], 
        .tab-content[id^="tabEdit"] input[type="url"], 
        .tab-content[id^="tabEdit"] input[type="number"], 
        .tab-content[id^="tabEdit"] select {
            font-size: 1.1em; padding: 14px; border-radius: 6px; border: 1px solid #bcc3ca; 
        }
        .tab-content[id^="tabEdit"] input[type="text"].has-image-bg,
        #goalDetailModal input[type="text"].has-image-bg, /* Goal modal is shared */
        #tabEditJogo .player-input-grid input[type="text"].has-image-bg { /* Plantel in Edit Jogo */
            background-repeat: no-repeat; background-position: 8px center;  
            background-size: 28px 28px; padding-left: 42px !important;  
        }
        .tab-content[id^="tabEdit"] input[readonly] { background-color: #e2e6ea; color: #495057; font-weight: 500; }
        
        /* Minute input styling for Edit Jogo */
        #tabEditJogo .minute-input-group { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
        #tabEditJogo .minute-input-group input[type="number"] { flex-grow: 1; }
        #tabEditJogo .minute-list { list-style: none; padding: 0; }
        #tabEditJogo .minute-list-item {
            padding: 10px 15px; font-size: 1em; border-radius: 4px; margin-bottom: 5px;
            display: flex; justify-content: space-between; align-items: center; 
            transition: background-color 0.3s ease, border-left-color 0.3s ease; 
            border-left: 5px solid transparent; 
        }
        #tabEditJogo .minute-text-scorer-container { 
            display: flex; align-items: center; flex-grow: 1; margin-right: 8px; flex-wrap: nowrap;     
        }
        #tabEditJogo .minute-text-scorer-container .minute-value,
        #tabEditJogo .minute-text-scorer-container .scorer-name { white-space: nowrap; }
        #tabEditJogo .minute-list-item .minute-value { font-weight: 500; cursor: pointer; text-decoration: underline;}
        #tabEditJogo .minute-list-item .scorer-name { font-style: italic; color: #555; margin-left: 8px; font-size: 0.9em;}
        #tabEditJogo .minute-list-item .remove-minute-btn {
            background: none; border: none; color: #dc3545; cursor: pointer;
            font-weight: bold; font-size: 1.3em; flex-shrink: 0; 
        }
        /* Status classes for minute items (reused from Criar Jogo) */
        .minute-list-item.status-pending { background-color: #fde0e0; border-left-color: #dc3545; }
        .minute-list-item.status-pending .minute-value { color: #721c24; }
        .minute-list-item.status-incomplete { background-color: #fff9e0; border-left-color: #ffc107; }
        .minute-list-item.status-incomplete .minute-value { color: #856404; }
        .minute-list-item.status-complete { background-color: #d4edda; border-left-color: #28a745; }
        .minute-list-item.status-complete .minute-value { color: #155724; }

        #tabEditJogo > form > button[type="submit"] {
            padding: 15px 30px; font-size: 1.25em; background-color: #0069d9; 
            font-weight: 600; width: auto; align-self: center; margin-top: 20px; 
        }
        #tabEditJogo > form > button[type="submit"]:hover { background-color: #0056b3; }
        .tab-content[id^="tabEdit"] .suggestions-container { border-color: #adb5bd; font-size: 1em; }
        .tab-content[id^="tabEdit"] .suggestion-item { padding: 12px; }
        
        /* Player input grid for Editar Jogo */
        #tabEditJogo .player-input-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 18px; margin-bottom: 20px; 
        }
        #tabEditJogo .player-input-wrapper { position: relative; display: flex; align-items: center; }
        #tabEditJogo .player-input-grid input[type="text"] { background-color: #fff; width: 100%; box-sizing: border-box; }
        
        .player-input-clear-btn { /* Shared between Criar & Editar Jogo plantel inputs */
            position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
            background: none; border: none; color: #888; font-size: 1.4em; 
            font-weight: bold; cursor: pointer; padding: 0 5px; line-height: 1;
            display: none; z-index: 2; 
        }
        .player-input-clear-btn:hover { color: #333; }

        .tab-content[id^="tabEdit"] input[type="text"].has-image-bg.has-clear-btn,
        #goalDetailModal input[type="text"].has-image-bg.has-clear-btn,
        #tabEditJogo .player-input-grid input[type="text"].has-image-bg.has-clear-btn { padding-right: 35px !important; }
        
        .tab-content[id^="tabEdit"] input[type="text"].has-clear-btn:not(.has-image-bg),
        #goalDetailModal input[type="text"].has-clear-btn:not(.has-image-bg),
        #tabEditJogo .player-input-grid input[type="text"].has-clear-btn:not(.has-image-bg) { padding-right: 35px !important; }

        #goalDetailModal .modal-content label { font-size: 1.15em; }
        #goalDetailModal .modal-content input[type="text"],
        #goalDetailModal .modal-content select,
        #goalDetailModal #goalZoneGridContainer { font-size: 1.05em; }
        
        #goalZoneGridContainer {
            display: grid; grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 55px); gap: 6px;
            margin-top: 5px; border: 1px solid #ccc; padding: 5px; border-radius: 4px;
        }
        .goal-zone-cell {
            display: flex; align-items: center; justify-content: center;
            border: 1px solid #ddd; background-color: #f9f9f9; cursor: pointer;
            font-size: 0.9em; text-align: center; transition: background-color 0.2s;
        }
        .goal-zone-cell:hover { background-color: #e9e9e9; }
        .goal-zone-cell.selected { background-color: #007bff; color: white; border-color: #0056b3; }

        /* Toggle legend for collapsible fieldsets (Editar Jogo) */
        #tabEditJogo .toggle-legend {
            cursor: pointer; display: flex; justify-content: space-between; 
            align-items: center; width: 100%; 
            padding-left: 0; padding-right: 0; box-sizing: border-box; 
        }
        #tabEditJogo .toggle-legend .toggle-indicator { font-weight: bold; font-size: 1.2em; margin-left: 10px; }
        
        #tabEditJogo fieldset.open .toggle-content { animation: slideDown 0.3s ease-out; }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); max-height: 0; }
            to { opacity: 1; transform: translateY(0); max-height: 1500px; }
        }

        .edit-item-selector {
            margin-bottom: 25px; padding: 20px; background-color: #f9f9f9;
            border-radius: 8px; border: 1px solid #e0e0e0;
        }
        .edit-item-selector label { font-size: 1.2em; font-weight: 500; margin-bottom: 10px; display: block; }

        #tabEditClube form fieldset,
        #tabEditPosicao form fieldset,
        #tabEditJogador form fieldset,
        #tabEditPais form fieldset { 
            border-left: 5px solid #fd7e14; /* Orange accent for these edit forms */
        }
        #tabEditClube form legend,
        #tabEditPosicao form legend,
        #tabEditJogador form legend,
        #tabEditPais form legend {
            color: #fd7e14;
        }
        .form-actions { display: flex; gap: 15px; margin-top: 10px; align-items: center; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Painel de Gestão Firebase - Editar Dados</h1>

        <div class="tab-navigation" id="editTabNavigation">
            <button class="tab-button" onclick="openTab(event, 'tabEditClube')">Editar Clube</button>
            <button class="tab-button" onclick="openTab(event, 'tabEditPosicao')">Editar Posição</button>
            <button class="tab-button" onclick="openTab(event, 'tabEditJogador')">Editar Jogador</button>
            <button class="tab-button" onclick="openTab(event, 'tabEditPais')">Editar País</button>
            <button class="tab-button" onclick="openTab(event, 'tabEditJogo')">Editar Jogo</button>
        </div>

        <!-- Tab Editar Clube -->
        <div id="tabEditClube" class="tab-content">
            <h2>Editar Clube Existente</h2>
            <div class="edit-item-selector"><label for="selectEditClubeNome">Procurar Clube para Editar:</label><input type="text" id="selectEditClubeNome" autocomplete="off" placeholder="Comece a digitar nome do clube..."><div id="selectEditClubeSuggestions" class="suggestions-container" style="display: none;"></div></div>
            <form id="formEditClube" style="display: none;"><fieldset><legend>Detalhes do Clube</legend><div><label for="editClubeNome">Nome do Clube (ID - Não editável):</label><input type="text" id="editClubeNome" readonly></div><div><label for="editClubeLogo">Link do Logo:</label><input type="url" id="editClubeLogo" required></div><div><label for="editClubeRegiao">Região:</label><input type="text" id="editClubeRegiao" required></div><div><label for="editClubeCidade">Cidade:</label><input type="text" id="editClubeCidade" required></div></fieldset><div class="form-actions"><button type="submit" id="saveEditClubeBtn" class="action-button">Guardar Alterações</button><button type="button" id="deleteClubeBtn" class="action-button danger">Eliminar Clube</button></div></form>
            <div id="statusEditClube" class="status-message"></div>
        </div>

        <!-- Tab Editar Posição -->
        <div id="tabEditPosicao" class="tab-content">
            <h2>Editar Posição Existente</h2>
            <div class="edit-item-selector"><label for="selectEditPosicaoInput">Procurar Posição para Editar:</label><input type="text" id="selectEditPosicaoInput" autocomplete="off" placeholder="Comece a digitar abreviação ou nome..."><div id="selectEditPosicaoSuggestions" class="suggestions-container" style="display: none;"></div></div>
            <form id="formEditPosicao" style="display: none;"><fieldset><legend>Detalhes da Posição</legend><div><label for="editPosicaoAbreviacao">Abreviação (ID - Não editável):</label><input type="text" id="editPosicaoAbreviacao" readonly></div><div><label for="editPosicaoGenericaForm">Posição Genérica:</label><input type="text" id="editPosicaoGenericaForm" required></div></fieldset><div class="form-actions"><button type="submit" id="saveEditPosicaoBtn" class="action-button">Guardar Alterações</button><button type="button" id="deletePosicaoBtn" class="action-button danger">Eliminar Posição</button></div></form>
            <div id="statusEditPosicao" class="status-message"></div>
        </div>

        <!-- Tab Editar Jogador -->
        <div id="tabEditJogador" class="tab-content">
            <h2>Editar Jogador Existente</h2>
            <div class="edit-item-selector"><label for="selectEditJogadorInput">Procurar Jogador para Editar:</label><input type="text" id="selectEditJogadorInput" autocomplete="off" placeholder="Comece a digitar nome do jogador..."><div id="selectEditJogadorSuggestions" class="suggestions-container" style="display: none;"></div></div>
            <form id="formEditJogador" style="display: none;"><fieldset><legend>Detalhes do Jogador</legend><div><label for="editJogadorNome">Nome do Jogador (ID - Não editável):</label><input type="text" id="editJogadorNome" readonly></div><div><label for="editJogadorImagem">Link da Imagem:</label><input type="url" id="editJogadorImagem" required></div><div><label for="editJogadorPosEspecifica">Posição Específica:</label><select id="editJogadorPosEspecifica" required></select></div><div><label for="editJogadorPosGenerica">Posição Genérica (Automático):</label><input type="text" id="editJogadorPosGenerica" readonly></div><div><label for="editJogadorPaisNome">Nome do País:</label><input type="text" id="editJogadorPaisNome" autocomplete="off" placeholder="Comece a digitar nome do país..."><div id="editJogadorPaisSuggestions" class="suggestions-container" style="display: none;"></div></div></fieldset><div class="form-actions"><button type="submit" id="saveEditJogadorBtn" class="action-button">Guardar Alterações</button><button type="button" id="deleteJogadorBtn" class="action-button danger">Eliminar Jogador</button></div></form>
            <div id="statusEditJogador" class="status-message"></div>
        </div>

        <!-- Tab Editar País -->
        <div id="tabEditPais" class="tab-content">
            <h2>Editar País Existente</h2>
            <div class="edit-item-selector"><label for="selectEditPaisInput">Procurar País para Editar:</label><input type="text" id="selectEditPaisInput" autocomplete="off" placeholder="Comece a digitar nome do país..."><div id="selectEditPaisSuggestions" class="suggestions-container" style="display: none;"></div></div>
            <form id="formEditPais" style="display: none;"><fieldset><legend>Detalhes do País</legend><div><label for="editPaisNome">Nome do País (ID - Não editável):</label><input type="text" id="editPaisNome" readonly></div><div><label for="editPaisBandeira">Link da Bandeira:</label><input type="url" id="editPaisBandeira" required></div><div><label for="editPaisContinenteSelect">Continente:</label><select id="editPaisContinenteSelect" required><option value="">A carregar continentes...</option></select></div></fieldset><div class="form-actions"><button type="submit" id="saveEditPaisBtn" class="action-button">Guardar Alterações</button><button type="button" id="deletePaisBtn" class="action-button danger">Eliminar País</button></div></form>
            <div id="statusEditPais" class="status-message"></div>
        </div>
        
        <!-- Tab Editar Jogo -->
        <div id="tabEditJogo" class="tab-content">
            <h2>Editar Jogo Existente</h2>
            <div class="edit-item-selector"><label for="selectEditJogoInput">Procurar Jogo para Editar:</label><input type="text" id="selectEditJogoInput" autocomplete="off" placeholder="Nome Jogo - Temporada - Jornada..."><div id="selectEditJogoSuggestions" class="suggestions-container" style="display: none;"></div></div>
            <form id="formEditJogo" style="display:none;">
                <fieldset> 
                    <legend>Informações Gerais do Jogo (Não Editáveis)</legend>
                    <div class="form-grid two-cols">
                        <div><label for="editJogoTemporada">Temporada:</label><input type="text" id="editJogoTemporada" readonly></div>
                        <div><label for="editJogoJornada">Jornada:</label><input type="text" id="editJogoJornada" readonly></div>
                        <div><label for="editJogoClubeCasa">Clube Casa:</label><input type="text" id="editJogoClubeCasa" readonly></div>
                        <div><label for="editJogoClubeFora">Clube Fora:</label><input type="text" id="editJogoClubeFora" readonly></div>
                    </div>
                </fieldset>
                <fieldset> 
                    <legend>Golos do Sporting (Editável)</legend>
                    <div class="form-grid two-cols">
                        <div><label for="editJogoMinutoGoloMarcadoInput">Minuto do Golo Marcado (Sporting):</label><div class="minute-input-group"><input type="number" id="editJogoMinutoGoloMarcadoInput" placeholder="Ex: 17" min="1"><button type="button" class="action-button secondary" id="addEditMinutoGoloMarcadoBtn">Adicionar</button></div><ul id="editListaMinutosGolosMarcados" class="minute-list"></ul></div>
                        <div><label for="editJogoMinutoGoloSofridoInput">Minuto do Golo Sofrido (pelo Sporting):</label><div class="minute-input-group"><input type="number" id="editJogoMinutoGoloSofridoInput" placeholder="Ex: 48" min="1"><button type="button" class="action-button secondary" id="addEditMinutoGoloSofridoBtn">Adicionar</button></div><ul id="editListaMinutosGolosSofridos" class="minute-list"></ul></div>
                    </div>
                </fieldset>
                <fieldset id="fieldsetEditPlacarStats"> 
                    <legend id="legendEditPlacarStats" class="toggle-legend">Placar e Estatísticas (Automático)<span class="toggle-indicator">[+]</span></legend>
                    <div class="toggle-content" style="display: none;">
                        <div style="margin-bottom: 15px;"><label for="editJogoNomeJogo">Nome do Jogo (Automático):</label><input type="text" id="editJogoNomeJogo" readonly></div>
                        <div class="form-grid three-cols">
                            <div><label for="editJogoGMCasa">Golos Marcados Equipa da Casa:</label><input type="text" id="editJogoGMCasa" readonly></div>
                            <div><label for="editJogoResultadoFinal">Resultado Final:</label><input type="text" id="editJogoResultadoFinal" readonly></div>
                            <div><label for="editJogoGMFora">Golos Marcados Equipa de Fora:</label><input type="text" id="editJogoGMFora" readonly></div>
                        </div>
                         <div class="form-grid two-cols" style="margin-top: 15px;">
                            <div><label for="editJogoGSCasa">Golos Sofridos Equipa da Casa:</label><input type="text" id="editJogoGSCasa" readonly></div>
                            <div><label for="editJogoGSFora">Golos Sofridos Equipa de Fora:</label><input type="text" id="editJogoGSFora" readonly></div>
                            <div><label for="editJogoMarcados1P">Golos Marcados Sporting (1ª Parte):</label><input type="text" id="editJogoMarcados1P" readonly></div>
                            <div><label for="editJogoMarcados2P">Golos Marcados Sporting (2ª Parte):</label><input type="text" id="editJogoMarcados2P" readonly></div>
                            <div><label for="editJogoSofridos1P">Golos Sofridos Sporting (1ª Parte):</label><input type="text" id="editJogoSofridos1P" readonly></div>
                            <div><label for="editJogoSofridos2P">Golos Sofridos Sporting (2ª Parte):</label><input type="text" id="editJogoSofridos2P" readonly></div>
                            <div><label for="editJogoEstado">Estado (Resultado Sporting):</label><input type="text" id="editJogoEstado" readonly></div>
                        </div>
                    </div>
                </fieldset>
                <fieldset> 
                    <legend>Plantel (Editável)</legend>
                    <div><label>11 Inicial (11 jogadores):</label><div id="editJogo11InicialContainer" class="player-input-grid"></div></div>
                    <div><label>Suplentes (11 jogadores):</label><div id="editJogoSuplentesContainer" class="player-input-grid"></div></div>
                </fieldset>
                <div class="form-actions">
                    <button type="submit" id="saveEditJogoBtn" class="action-button">Guardar Alterações</button>
                    <button type="button" id="deleteEditJogoBtn" class="action-button danger">Eliminar Jogo</button>
                </div>
            </form>
            <div id="statusEditJogo" class="status-message"></div>
        </div>

    </div> <!-- End of .container -->

    <!-- Modal for Goal Details (Shared) -->
    <div id="goalDetailModal" class="modal">
        <div class="modal-content">
            <span class="modal-close-btn" id="closeGoalDetailModalBtn">×</span>
            <h3 id="goalDetailModalTitle">Detalhes do Golo</h3>
            <form id="formGoalDetail">
                <input type="hidden" id="goalDetailContext" value="edit"> <!-- Default context for this page -->
                <input type="hidden" id="goalDetailType">
                <input type="hidden" id="goalDetailMinute">
                <div id="goalDetailScorerSection">
                    <label for="goalDetailJogador">Marcador (Jogador do Sporting):</label>
                    <input type="text" id="goalDetailJogador" class="has-image-bg" autocomplete="off" placeholder="Pesquisar jogador...">
                    <div id="goalDetailJogadorSuggestions" class="suggestions-container" style="display: none;"></div>
                </div>
                <div>
                    <label for="goalDetailZonaGrid">Zona do Golo:</label>
                    <div id="goalZoneGridContainer"></div>
                    <input type="hidden" id="selectedGoalZoneHidden">
                </div>
                <div id="goalDetailAssistenciaSection" style="margin-top:15px;">
                    <label for="goalDetailAssistencia">Assistência (Jogador do Sporting):</label>
                    <input type="text" id="goalDetailAssistencia" class="has-image-bg" autocomplete="off" placeholder="Pesquisar jogador...">
                    <div id="goalDetailAssistenciaSuggestions" class="suggestions-container" style="display: none;"></div>
                </div>
                <button type="button" id="saveGoalDetailBtn" class="action-button" style="margin-top:20px;">Guardar Detalhes</button>
            </form>
        </div>
    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, collection, getDocs, serverTimestamp, addDoc, query, where, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Firebase Initialization
        const firebaseConfig = {
            apiKey: "AIzaSyASIFSwhZj8B4ON6fVGjNixgLW-CL39CnI",
            authDomain: "sporting-stats.firebaseapp.com",
            projectId: "sporting-stats",
            storageBucket: "sporting-stats.firebasestorage.app",
            messagingSenderId: "584175657940",
            appId: "1:584175657940:web:7e57b0b83f2b22646d6c41"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- GLOBAL CACHES & STATE --- (Focado em Edição)
        let posicoesMap = new Map();
        let allPosicoesArray = []; // { id, abreviacao, posicao_generica, display }
        let allPaisesData = []; // {id(nome), nome, bandeira, continente}
        let allContinentesSet = new Set();
        let allClubes = []; // { id, nome, logo, regiao, cidade } - Completo para edição
        let allJogadores = []; // { id(nome_jogador), nome, imagem_link, ...}
        let allJogosCache = []; // {id, nomeJogo, temporada, jornada, displayString, ...full data}

        // "Editar Jogo" specific state
        let editMinutosGolosMarcados = [];
        let editMinutosGolosSofridos = [];
        let currentEditingJogoId = null;
        let currentEditingJogoData = null; 

        const goalZoneNames = [ /* ... (como antes) ... */ ];
        const sportingCanonicoNomeDb = "Sporting CP";
        const sportingCanonicoNomesInput = ["Sporting CP", "Sporting"];
        
        let currentEditingClubId = null;
        let currentEditingPosicaoId = null;
        let currentEditingJogadorId = null;
        let currentEditingPaisId = null;


        // --- DOM ELEMENTS (todos os relevantes para as abas de Edição) ---
        const editTabNavigation = document.getElementById('editTabNavigation');
        // ... (todos os outros seletores DOM para elementos dentro das abas de edição, como definidos na versão completa)

        // --- UTILITY FUNCTIONS ---
        function showStatus(elementId, message, isSuccess) { /* ... (implementação completa como antes) ... */ }
        function setupSuggestionHandler(inputElement, suggestionsContainer, dataArray, displayField, imageField, clearBtnElement, onSuggestionClick, dataItemToText) { /* ... (implementação completa como antes) ... */ }

        // --- TAB LOGIC (Simplificada para apenas um painel de abas de edição) ---
        window.openTab = function(evt, tabName) {
            var i, tabcontent, tabbuttons;
            tabcontent = document.getElementsByClassName("tab-content"); // Só há um conjunto de tab-content nesta versão
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tabbuttons = editTabNavigation.getElementsByClassName("tab-button");
            for (i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].className = tabbuttons[i].className.replace(" active", "");
            }
            const targetTab = document.getElementById(tabName);
            if(targetTab) targetTab.style.display = "block";
            
            let eventTargetButton = null;
            if (evt && evt.currentTarget) { 
                eventTargetButton = evt.currentTarget;
            } else { 
                for (i = 0; i < tabbuttons.length; i++) {
                    const onclickAttr = tabbuttons[i].getAttribute('onclick');
                    if (onclickAttr && onclickAttr.includes(`'${tabName}'`)) {
                        eventTargetButton = tabbuttons[i];
                        break;
                    }
                }
            }
            if(eventTargetButton) eventTargetButton.className += " active";

            // --- Data loading specific to opened edit tab ---
            if (tabName === 'tabEditClube') {
                if(formEditClube) formEditClube.style.display = 'none'; 
                if(selectEditClubeNomeInput) selectEditClubeNomeInput.value = ''; 
                if (allClubes.length === 0) loadAllClubesData().then(setupEditClubeSuggestions); else setupEditClubeSuggestions(); 
            } else if (tabName === 'tabEditPosicao') {
                if(formEditPosicao) formEditPosicao.style.display = 'none';
                if(selectEditPosicaoInput) selectEditPosicaoInput.value = '';
                if (allPosicoesArray.length === 0) loadAllPosicoesData().then(setupEditPosicaoSuggestions); else setupEditPosicaoSuggestions();
            } else if (tabName === 'tabEditJogador') {
                if(formEditJogador) formEditJogador.style.display = 'none';
                if(selectEditJogadorInput) selectEditJogadorInput.value = '';
                if (allJogadores.length === 0) loadAllJogadoresCache().then(setupEditJogadorSuggestions); else setupEditJogadorSuggestions();
                loadPosicoesParaDropdown(editJogadorPosEspecificaDropdown); 
                loadPaisesParaSugestoes(editJogadorPaisNomeInput, editJogadorPaisSuggestions, true); 
            } else if (tabName === 'tabEditPais') {
                if(formEditPais) formEditPais.style.display = 'none';
                if(selectEditPaisInput) selectEditPaisInput.value = '';
                if (allPaisesData.length === 0) loadAllPaisesData(true).then(setupEditPaisSuggestions); else setupEditPaisSuggestions();
                loadContinentesParaDropdown(editPaisContinenteSelect, true); 
            } else if (tabName === 'tabEditJogo') {
                if(formEditJogo) formEditJogo.style.display = 'none';
                if(selectEditJogoInput) selectEditJogoInput.value = '';
                if(allJogosCache.length === 0) loadAllJogosCache().then(setupEditJogoSuggestions); else setupEditJogoSuggestions();
                if(allJogadores.length === 0) loadAllJogadoresCache(); 
                if (goalZoneGridContainer && goalZoneGridContainer.children.length === 0) populateGoalZoneGrid();
                if (editJogo11InicialContainer && editJogo11InicialContainer.children.length === 0) setupDynamicPlayerInputs_contextAware('editJogo11InicialContainer', 11, 'editInicial', 'edit');
                if (editJogoSuplentesContainer && editJogoSuplentesContainer.children.length === 0) setupDynamicPlayerInputs_contextAware('editJogoSuplentesContainer', 11, 'editSuplente', 'edit');
                if (allJogadores.length > 0) { 
                    if(goalDetailJogadorInput) setupSuggestionHandler(goalDetailJogadorInput, goalDetailJogadorSuggestions, allJogadores, 'nome', 'imagem_link');
                    if(goalDetailAssistenciaInput) setupSuggestionHandler(goalDetailAssistenciaInput, goalDetailAssistenciaSuggestions, allJogadores, 'nome', 'imagem_link');
                }
            }
        };

        // --- DATA LOADING FUNCTIONS (Focadas em Edição) ---
        async function loadAllJogadoresCache() { /* ... (definição completa focada em dados para edição) ... */ }
        async function loadAllPosicoesData() { /* ... (definição completa) ... */ }
        async function loadPosicoesParaDropdown(dropdownElement) { /* ... (definição completa, focada em editJogadorPosEspecificaDropdown) ... */ }
        async function loadAllPaisesData(forEditContextOrFullLoad = true) { /* ... (definição completa, forEditContextOrFullLoad = true por padrão) ... */ }
        async function loadPaisesParaSugestoes(inputElement, suggestionsContainer, forEditForm) { /* ... (definição completa, focada em editJogadorPaisNomeInput) ... */ }
        async function loadAllContinentesSet() { /* ... (definição completa) ... */ }
        async function loadContinentesParaDropdown(selectElement, isEditContext = true) { /* ... (definição completa, isEditContext = true por padrão, focada em editPaisContinenteSelect) ... */ }
        async function loadAllClubesData() { /* ... (definição completa, focada em popular allClubes para 'Editar Clube') ... */ }
        async function loadAllJogosCache() { /* ... (definição completa) ... */ }

        // --- GOAL DETAIL MODAL LOGIC (Contexto 'edit') ---
        function populateGoalZoneGrid() { /* ... (definição completa) ... */ }
        function handleZoneSelection(event) { /* ... (definição completa) ... */ }
        function openGoalDetailModal_contextAware(event) { /* ... (definição completa, usando 'edit' como contexto e editMinutosGolosMarcados/Sofridos) ... */ }
        function saveGoalDetailsFromModal() { /* ... (definição completa, usando 'edit' como contexto) ... */ }

        // --- "EDITAR JOGO" - COMMON FUNCTIONS (Context-Aware, mas aqui o contexto será sempre 'edit') ---
        function getGoalDetailStatus(details, type) { /* ... (definição completa) ... */ }
        function renderMinuteList_contextAware(listElement, minutesArray, type, context) { /* ... (definição completa, contexto será 'edit') ... */ }
        function addMinuteEntry_contextAware(type, listElement, minutesArray, context) { /* ... (definição completa, contexto será 'edit') ... */ }
        function setupDynamicPlayerInputs_contextAware(containerId, numPlayers, rolePrefix, context) { /* ... (definição completa, contexto será 'edit') ... */ }
        function updateCalculatedScores_contextAware(context) { /* ... (definição completa, contexto será 'edit') ... */ }

        // --- "EDITAR" FORMS LOGIC & HANDLERS ---
        // --- Editar Clube ---
        function setupEditClubeSuggestions() { /* ... (definição completa) ... */ }
        async function handleFormEditClubeSubmit(e) { /* ... (definição completa) ... */ }
        async function handleDeleteClube() { /* ... (definição completa) ... */ }
        // --- Editar Posição ---
        function setupEditPosicaoSuggestions() { /* ... (definição completa) ... */ }
        async function handleFormEditPosicaoSubmit(e) { /* ... (definição completa) ... */ }
        async function handleDeletePosicao() { /* ... (definição completa) ... */ }
        // --- Editar Jogador ---
        function setupEditJogadorSuggestions() { /* ... (definição completa) ... */ }
        async function handleFormEditJogadorSubmit(e) { /* ... (definição completa) ... */ }
        async function handleDeleteJogador() { /* ... (definição completa) ... */ }
        // --- Editar País ---
        function setupEditPaisSuggestions() { /* ... (definição completa) ... */ }
        async function handleFormEditPaisSubmit(e) { /* ... (definição completa) ... */ }
        async function handleDeletePais() { /* ... (definição completa) ... */ }
        // --- Editar Jogo ---
        function setupEditJogoSuggestions() { /* ... (definição completa) ... */ }
        function populateEditJogoForm(data) { /* ... (definição completa) ... */ }
        // populatePlantelInputs_contextAware já está em common functions
        async function handleFormEditJogoSubmit(e) { /* ... (definição completa) ... */ }
        async function handleDeleteEditJogo() { /* ... (definição completa) ... */ }

        // --- INITIALIZATION (DOMContentLoaded) ---
        document.addEventListener('DOMContentLoaded', () => {
            const firstEditTabButton = editTabNavigation.querySelector('.tab-button');
            if (firstEditTabButton) {
                const onclickAttr = firstEditTabButton.getAttribute('onclick');
                const match = onclickAttr.match(/openTab\s*\(\s*event\s*,\s*'([^']*)'\s*\)/); // Simplificado para openTab sem panelId
                if (match && match[1]) {
                    openTab(null, match[1]); // Open first edit tab programmatically
                }
            } else {
                console.warn("Nenhum botão de aba encontrado para abrir inicialmente.");
            }
            
            const editPlacarStatsLegend = document.getElementById('legendEditPlacarStats');
            const editPlacarStatsContent = document.querySelector('#fieldsetEditPlacarStats .toggle-content');
            const editPlacarStatsFieldset = document.getElementById('fieldsetEditPlacarStats');
            const editPlacarStatsIndicator = editPlacarStatsLegend?.querySelector('.toggle-indicator');
            if (editPlacarStatsLegend && editPlacarStatsContent && editPlacarStatsIndicator && editPlacarStatsFieldset) {
                editPlacarStatsLegend.addEventListener('click', () => {
                    const isOpen = editPlacarStatsContent.style.display === 'block';
                    editPlacarStatsContent.style.display = isOpen ? 'none' : 'block';
                    if(editPlacarStatsIndicator) editPlacarStatsIndicator.textContent = isOpen ? '[+]' : '[-]';
                    editPlacarStatsFieldset.classList.toggle('open', !isOpen);
                });
            }
            
            // Initial data loads relevant for editing
            loadAllJogadoresCache(); 
            loadAllPosicoesData();
            loadAllPaisesData(true); // Load full paises data
            loadAllClubesData();    // Load clubes for editing
            loadAllJogosCache();    // Load jogos cache
            
            // Event listeners for "Editar Jogo" minute buttons
            addEditMinutoGoloMarcadoBtn?.addEventListener('click', () => addMinuteEntry_contextAware('marcado', editListaMinutosGolosMarcadosEl, editMinutosGolosMarcados, 'edit'));
            addEditMinutoGoloSofridoBtn?.addEventListener('click', () => addMinuteEntry_contextAware('sofrido', editListaMinutosGolosSofridosEl, editMinutosGolosSofridos, 'edit'));
            
            // Event listener for "Editar Jogador" position change
            editJogadorPosEspecificaDropdown?.addEventListener('change', function() {
                if(editJogadorPosGenericaInput) editJogadorPosGenericaInput.value = this.value && posicoesMap.has(this.value) ? posicoesMap.get(this.value) : '';
            });
            
            // Goal Modal
            closeGoalDetailModalBtn?.addEventListener('click', () => {if(goalDetailModal) goalDetailModal.style.display = 'none'});
            saveGoalDetailBtn?.addEventListener('click', saveGoalDetailsFromModal);

            // EDITAR FORMS & DELETE BUTTONS
            formEditClube?.addEventListener('submit', handleFormEditClubeSubmit);
            deleteClubeBtn?.addEventListener('click', handleDeleteClube);
            formEditPosicao?.addEventListener('submit', handleFormEditPosicaoSubmit);
            deletePosicaoBtn?.addEventListener('click', handleDeletePosicao);
            formEditJogador?.addEventListener('submit', handleFormEditJogadorSubmit);
            deleteJogadorBtn?.addEventListener('click', handleDeleteJogador);
            formEditPais?.addEventListener('submit', handleFormEditPaisSubmit);
            deletePaisBtn?.addEventListener('click', handleDeletePais);
            formEditJogo?.addEventListener('submit', handleFormEditJogoSubmit);
            deleteEditJogoBtn?.addEventListener('click', handleDeleteEditJogo);
        });
    </script>
</body>
</html>
